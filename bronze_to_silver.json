{
    "name": "df_bronze_to_silver_Adjustment_Beth",
    "properties": {
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "ds_bronze_common",
                        "type": "DatasetReference"
                    },
                    "name": "SrcBronzeBh"
                },
                {
                    "dataset": {
                        "referenceName": "ds_bronze_legacymasterxref",
                        "type": "DatasetReference"
                    },
                    "name": "SrcLkpLegacyMasterXref"
                },
                {
                    "dataset": {
                        "referenceName": "ds_SHIPMENT_ODS_SAP_LEGACY_SHIP_PLANT_XREF",
                        "type": "DatasetReference"
                    },
                    "name": "SrcLkpLegacyPlantXref"
                },
                {
                    "dataset": {
                        "referenceName": "ds_SHIPMENT_ODS_LEGACY_REF_MASTER_XREF",
                        "type": "DatasetReference"
                    },
                    "name": "SrcLkpOdsRefMasterXref"
                },
                {
                    "dataset": {
                        "referenceName": "ds_SHIPMENT_ODS_SAP_PLANT_DETAIL_XREF",
                        "type": "DatasetReference"
                    },
                    "name": "SrcLkpSapPlantMaster"
                },
                {
                    "dataset": {
                        "referenceName": "ds_sap_customer_master",
                        "type": "DatasetReference"
                    },
                    "name": "SrcLkpSapCustomerMaster"
                },
                {
                    "dataset": {
                        "referenceName": "ds_SHIPMENT_ODS_SAP_MATERIAL_GROUP_MASTER_XREF",
                        "type": "DatasetReference"
                    },
                    "name": "SrcLkpSapMaterialGroupMasterXref"
                },
                {
                    "dataset": {
                        "referenceName": "ds_bronze_common",
                        "type": "DatasetReference"
                    },
                    "name": "SrcBronzeErr"
                },
                {
                    "dataset": {
                        "referenceName": "ds_SHIPMENT_ODS_SAP_MATLS_TO_MATL_GROUPS",
                        "type": "DatasetReference"
                    },
                    "name": "SrcSapPrimeLFR"
                },
                {
                    "dataset": {
                        "referenceName": "ds_TRUCK_ROUTE_DESC",
                        "type": "DatasetReference"
                    },
                    "name": "SrcTruckRailRouteDesc"
                }
            ],
            "sinks": [
                {
                    "name": "SnkLegacyMasterCache"
                },
                {
                    "name": "SnkOdsRefMasterXrefCache"
                },
                {
                    "name": "SnkLegacyPlantXref"
                },
                {
                    "name": "SnkPlantMasterXrefCache"
                },
                {
                    "name": "SnkCustomerMasterXrefCache"
                },
                {
                    "dataset": {
                        "referenceName": "ds_silver_common",
                        "type": "DatasetReference"
                    },
                    "name": "shipmentparquet"
                },
                {
                    "name": "CacheSnkSapMaterialGroupXref"
                },
                {
                    "dataset": {
                        "referenceName": "ds_silver_common",
                        "type": "DatasetReference"
                    },
                    "name": "SnkErr"
                },
                {
                    "name": "SnkSapPrimeLFR"
                },
                {
                    "name": "SnkTruckRouteDesc"
                }
            ],
            "transformations": [
                {
                    "name": "DerivedCols"
                },
                {
                    "name": "ErrorFields"
                },
                {
                    "name": "SplitOnErrors"
                },
                {
                    "name": "ErrorFieldsAggregation"
                },
                {
                    "name": "FtrEdsLegacy"
                },
                {
                    "name": "FtrBhLfr"
                },
                {
                    "name": "FtrBeth"
                },
                {
                    "name": "SelectReqClmns"
                },
                {
                    "name": "CastToString"
                },
                {
                    "name": "SelectErrorFields"
                },
                {
                    "name": "LookupsAndDateConversion"
                },
                {
                    "name": "PlantAndKunnrLookup"
                },
                {
                    "name": "OdsStandardConversion"
                },
                {
                    "name": "exists1"
                },
                {
                    "name": "existsmappingconversion"
                },
                {
                    "name": "SelectExists"
                },
                {
                    "name": "union1"
                },
                {
                    "name": "FreightErrorSelect"
                },
                {
                    "name": "union2"
                },
                {
                    "name": "ValidShipmentRecord1"
                },
                {
                    "name": "select1"
                },
                {
                    "name": "BHLFRShippingColumns",
                    "description": "Adding Shipping Columns"
                },
                {
                    "name": "FtrBethRec"
                },
                {
                    "name": "OdsStandardConv"
                },
                {
                    "name": "ConvertUpper"
                },
                {
                    "name": "FtrInvalisRec"
                },
                {
                    "name": "AgrBol"
                },
                {
                    "name": "Joinwithsrc"
                },
                {
                    "name": "SelectSrcColns"
                },
                {
                    "name": "JoinErr"
                },
                {
                    "name": "SelectErr"
                },
                {
                    "name": "exists2"
                },
                {
                    "name": "UnionSrcErr"
                },
                {
                    "name": "derivedColumn1"
                },
                {
                    "name": "derivedColumn2"
                },
                {
                    "name": "InternalShipmentCalc"
                },
                {
                    "name": "windowLoadWeight"
                },
                {
                    "name": "ChargeTypeBasedColumns"
                },
                {
                    "name": "derivedColumn6"
                },
                {
                    "name": "derivedColumn7"
                },
                {
                    "name": "unpivotChargeType"
                },
                {
                    "name": "selectToRemoveNumericFields"
                },
                {
                    "name": "derivedColumn8"
                },
                {
                    "name": "derivedColumn9"
                },
                {
                    "name": "derivedColumn10"
                },
                {
                    "name": "derivedColumn11"
                },
                {
                    "name": "ShipFromToStationCityState"
                },
                {
                    "name": "MinWeightCalc"
                },
                {
                    "name": "ItemLHAmountCalc"
                },
                {
                    "name": "ItemFreightWeightCalc"
                },
                {
                    "name": "RailRouteFullDesc"
                },
                {
                    "name": "derivedColumn12"
                },
                {
                    "name": "FreightSplit"
                },
                {
                    "name": "FreightErrorFieldsAggregation"
                },
                {
                    "name": "InvoiceSplit"
                },
                {
                    "name": "InvoiceErrorFieldsAggregation"
                },
                {
                    "name": "ValidErrorFieldsAggregation"
                },
                {
                    "name": "InvoiceErrorSelect"
                },
                {
                    "name": "ValidSelect"
                },
                {
                    "name": "FreightErrorFields"
                },
                {
                    "name": "InvoiceErrorFields"
                },
                {
                    "name": "ValidErrorFields"
                },
                {
                    "name": "derivedColumn19"
                },
                {
                    "name": "union3"
                },
                {
                    "name": "union4"
                }
            ],
            "scriptLines": [
                "parameters{",
                "     OVER_DIMENSIONAL as string,",
                "     NewShipmentFileName as string,",
                "     ERROR_FILENAME as string,",
                "     FolderPath as string,",
                "     CreatedDateOds as string",
                "}",
                "source(output(",
                "          ACD as string,",
                "          INVOICE_NUM as string,",
                "          MATERIAL_ID as string,",
                "          INVOICE_CC_INVOICE_YEAR as string,",
                "          INVOICE_MONTH as string,",
                "          INVOICE_DAY as string,",
                "          PACK_BOL_NUM as string,",
                "          PACK_SLIP_NUM as string,",
                "          SHIPPED_CC_SHIPPED_YEAR as string,",
                "          SHIPPED_MONTH as string,",
                "          SHIPPED_DAY as string,",
                "          SHIP_MO as string,",
                "          SHIP_DAY as string,",
                "          SHIP_YEAR as string,",
                "          SHIPPED_TIME as string,",
                "          MS_INTERPLANT as string,",
                "          METH_OF_SHIP as string,",
                "          SCAC_CODE as string,",
                "          SCAC_DESCR as string,",
                "          ROUTE_CODE as string,",
                "          ROUTE_DESCR as string,",
                "          VEHICLE_ID as string,",
                "          P_C_IND as string,",
                "          PREPAID_COLLECT as string,",
                "          MILEAGE as string,",
                "          DISTANCE_UOM as string,",
                "          TOTAL_SHIP_WEIGHT as string,",
                "          UOM_WEIGHT as string,",
                "          MIN_WEIGHT as string,",
                "          MIN_WEIGHT_UOM as string,",
                "          TOTAL_FRT_COST as string,",
                "          FRT_RATE as string,",
                "          FRT_UOM as string,",
                "          ADDTNL_FRT_COST as string,",
                "          ADDTNL_FRT_RATE as string,",
                "          ADDTNL_FRT_UOM as string,",
                "          FRT_COST_SC as string,",
                "          FRT_SC_RATE as string,",
                "          FRT_SC_UOM as string,",
                "          CUST_CODE as string,",
                "          BILL_TO_CUSTOMER as string,",
                "          ORIG_CUST_CODE as string,",
                "          SHIP_FROM_DESCR as string,",
                "          SHIP_FROM_STATE as string,",
                "          SHIP_FROM_CITY as string,",
                "          SHIP_FROM_ZIP_CODE as string,",
                "          SHIP_FROM_COUNTRY as string,",
                "          DEST_CUST_CODE as string,",
                "          SHIP_TO_CUSTOMER as string,",
                "          SHIP_TO_STATE as string,",
                "          SHIP_TO_CITY as string,",
                "          SHIP_TO_ZIP_CODE as string,",
                "          SHIP_TO_COUNTRY as string,",
                "          DATA_SOURCE as string,",
                "          COMPETITIVE_IND as string,",
                "          CONTRACT_RATE as string,",
                "          MILL_ORDER_SPLIT_NO1 as string,",
                "          MS_ORDER_MILL_SPLIT_NO2 as string,",
                "          FACILITY_CODE as string,",
                "          STCC_CODE_OUT as string,",
                "          THICKNESS_MAX as string,",
                "          THICKNESS_UOM as string,",
                "          WIDTH_MAX as string,",
                "          WIDTH_UOM as string,",
                "          LENGTH_MAX as string,",
                "          LENGTH_UOM as string,",
                "          PART_NUMBER as string,",
                "          PART_NUMBER_DESC as string,",
                "          COMMODITY_DESCR as string,",
                "          ITEM_FRT_COST as string,",
                "          MATL_ID_WEIGHT as string,",
                "          MATL_ID_LAST_COIL as string,",
                "          MATL_ID_PRO_AMT as string,",
                "          MATL_ID_SC_AMT as string,",
                "          CUST_FRT as string,",
                "          POSTING_PERIOD as string,",
                "          ITEM_SHIPPED_PIECES as string,",
                "          PROCESSOR_MATL_ID as string,",
                "          OUT_TM_AVAIL_TO_SHIP_DATE as string,",
                "          OUT_TM_LOAD_READY_DATE as string,",
                "          OUT_TM_DATE_SCHD_PICKUP as string,",
                "          OUT_TM_PLN_CARRIER_PICKUP_DTE as string,",
                "          OUT_PLANNED_TRANS_MODE as string,",
                "          OUT_PLANNED_FRT_TYPE_CODE as string,",
                "          OUT_PLANNED_NEXT_SHIP_DATE as string,",
                "          OUT_HEAT_NBR as string,",
                "          ACCT_PROD_CODE as string,",
                "          BETH_SOURCE_CODE as string,",
                "          LINEAL_FT_ENG as string,",
                "          LINEAL_FT_MET as string,",
                "          THEO_WGT_LB as string,",
                "          THEO_WGT_KG as string,",
                "          TIME_ZONE as string,",
                "          SAP_ORDER_NUM as string,",
                "          STATUS as string,",
                "          ACTION as string,",
                "          BOL_NUMBER as string,",
                "          SHIPMENT_DATE as string,",
                "          SOURCE_SYSTEM as string,",
                "          {_c95} as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     moveFiles: [($FolderPath),(concat($FolderPath,'/','inprogress'))],",
                "     format: 'parquet',",
                "     wildcardPaths:[(concat($FolderPath, '/', '*.parquet'))]) ~> SrcBronzeBh",
                "source(output(",
                "          SAP_PARVW as string,",
                "          LEGACY_SYSTEM as string,",
                "          LOCAL_CUSTOMER_CODE as string,",
                "          SAP_KUNNR as string,",
                "          DATE_CREATED as timestamp,",
                "          CREATED_BY as string,",
                "          DATE_UPDATED as timestamp,",
                "          UPDATED_BY as string,",
                "          DATE_LAST_USED as timestamp,",
                "          DATE_FIRST_APPEARANCE as timestamp,",
                "          TRANSLATION_COMMENT as string,",
                "          COMMENT_DATE_UPDATED as timestamp,",
                "          COMMENT_UPDATED_BY as string,",
                "          EXCLUDE_ORDER_ENTRY as boolean",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcLkpLegacyMasterXref",
                "source(output(",
                "          ID as integer,",
                "          MUID as string,",
                "          VersionName as string,",
                "          VersionNumber as integer,",
                "          Version_ID as integer,",
                "          VersionFlag as string,",
                "          Name as string,",
                "          Code as string,",
                "          ChangeTrackingMask as integer,",
                "          SAP_SOURCE_SYSTEM_Code as string,",
                "          SAP_SOURCE_SYSTEM_Name as string,",
                "          SAP_SOURCE_SYSTEM_ID as integer,",
                "          SAP_LEGACY_PLANT_CODE as string,",
                "          SAP_DESTINATION_SYSTEM_Code as string,",
                "          SAP_DESTINATION_SYSTEM_Name as string,",
                "          SAP_DESTINATION_SYSTEM_ID as integer,",
                "          SAP_PLANT_ID as string,",
                "          EnterDateTime as timestamp,",
                "          EnterUserName as string,",
                "          EnterVersionNumber as integer,",
                "          LastChgDateTime as timestamp,",
                "          LastChgUserName as string,",
                "          LastChgVersionNumber as integer,",
                "          ValidationStatus as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcLkpLegacyPlantXref",
                "source(output(",
                "          ID as integer,",
                "          MUID as string,",
                "          VersionName as string,",
                "          VersionNumber as integer,",
                "          Version_ID as integer,",
                "          VersionFlag as string,",
                "          Name as string,",
                "          Code as string,",
                "          ChangeTrackingMask as integer,",
                "          SOURCE_SYSTEM_Code as string,",
                "          SOURCE_SYSTEM_Name as string,",
                "          SOURCE_SYSTEM_ID as integer,",
                "          SOURCE_CODE_TYPE as string,",
                "          SOURCE_CODE_VALUE as string,",
                "          DESTINATION_SYSTEM_Code as string,",
                "          DESTINATION_SYSTEM_Name as string,",
                "          DESTINATION_SYSTEM_ID as integer,",
                "          DESTINATION_CODE_TYPE as string,",
                "          DESTINATION_CODE_VALUE as string,",
                "          EnterDateTime as timestamp,",
                "          EnterUserName as string,",
                "          EnterVersionNumber as integer,",
                "          LastChgDateTime as timestamp,",
                "          LastChgUserName as string,",
                "          LastChgVersionNumber as integer,",
                "          ValidationStatus as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcLkpOdsRefMasterXref",
                "source(output(",
                "          ID as integer,",
                "          MUID as string,",
                "          VersionName as string,",
                "          VersionNumber as integer,",
                "          Version_ID as integer,",
                "          VersionFlag as string,",
                "          Name as string,",
                "          Code as string,",
                "          ChangeTrackingMask as integer,",
                "          SAP_PLANT_ID as string,",
                "          SAP_PLANT_NAME1 as string,",
                "          SAP_PLANT_NAME2 as string,",
                "          SAP_STREET as string,",
                "          SAP_CITY as string,",
                "          SAP_POST_CODE as string,",
                "          SAP_STATE as string,",
                "          SAP_COUNTRY as string,",
                "          STATION_CITY_STATE1 as string,",
                "          STATION_CITY_STATE2 as string,",
                "          EnterDateTime as timestamp,",
                "          EnterUserName as string,",
                "          EnterVersionNumber as integer,",
                "          LastChgDateTime as timestamp,",
                "          LastChgUserName as string,",
                "          LastChgVersionNumber as integer,",
                "          ValidationStatus as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcLkpSapPlantMaster",
                "source(output(",
                "          SAP_KUNNR as string,",
                "          SAP_TITLE as string,",
                "          SAP_NAME1 as string,",
                "          SAP_NAME2 as string,",
                "          SAP_NAME3 as string,",
                "          SAP_NAME4 as string,",
                "          SAP_SORT1 as string,",
                "          SAP_SORT2 as string,",
                "          SAP_NAME_CO as string,",
                "          SAP_STREET as string,",
                "          SAP_HOUSE_NUM1 as string,",
                "          SAP_HOUSE_NUM2 as string,",
                "          SAP_STR_SUPPL1 as string,",
                "          SAP_STR_SUPPL2 as string,",
                "          SAP_STR_SUPPL3 as string,",
                "          SAP_CITY2 as string,",
                "          SAP_POST_CODE1 as string,",
                "          SAP_CITY1 as string,",
                "          SAP_COUNTRY as string,",
                "          SAP_REGION as string,",
                "          SAP_TIME_ZONE as string,",
                "          SAP_TAXJURCODE as string,",
                "          SAP_TRANSPZONE as string,",
                "          SAP_PO_BOX as string,",
                "          SAP_POST_CODE2 as string,",
                "          SAP_PO_BOX_LOC as string,",
                "          SAP_PO_BOX_CTY as string,",
                "          SAP_PO_BOX_REG as string,",
                "          SAP_SPRAS as string,",
                "          SAP_DUNS_NUMBER as string,",
                "          SAP_BANKS as string,",
                "          SAP_BANKL as string,",
                "          SAP_BANKN as string,",
                "          SAP_XEZER as string,",
                "          SAP_BANKA as string,",
                "          SAP_KNRZA as string,",
                "          SAP_BRSCH as string,",
                "          SAP_ABLAD as string,",
                "          SAP_KNFAK as string,",
                "          SAP_WANID as string,",
                "          SAP_AKONT as string,",
                "          SAP_ZUAWA as string,",
                "          SAP_ALTKN as string,",
                "          SAP_ZTERM as string,",
                "          SAP_TOGRU as string,",
                "          SAP_XZVER as string,",
                "          SAP_HBKID as string,",
                "          SAP_LOCKB as string,",
                "          SAP_VKBUR as string,",
                "          SAP_VKGRP as string,",
                "          SAP_KDGRP as string,",
                "          SAP_WAERS as string,",
                "          SAP_AWAHR as integer,",
                "          SAP_KALKS as string,",
                "          SAP_VERSG as string,",
                "          SAP_KVGR1 as string,",
                "          SAP_KVGR2 as string,",
                "          SAP_KVGR3 as string,",
                "          SAP_LPRIO as integer,",
                "          SAP_VSBED as string,",
                "          SAP_KZAZU as string,",
                "          SAP_AUTLF as string,",
                "          SAP_KZTLF as string,",
                "          SAP_ANTLF as decimal(2,0),",
                "          SAP_MRNKZ as string,",
                "          SAP_BOKRE as string,",
                "          SAP_PRFRE as string,",
                "          SAP_INCO1 as string,",
                "          SAP_INCO2 as string,",
                "          SAP_KTGRD as string,",
                "          SAP_TAXKD as string,",
                "          DATE_UPDATED as timestamp,",
                "          UPDATED_BY as string,",
                "          DATE_CREATED as timestamp,",
                "          CREATED_BY as string,",
                "          SAP_KTOKD as string,",
                "          SAP_BUKRS as string,",
                "          SAP_VKORG as string,",
                "          SAP_VTWEG as string,",
                "          SAP_SPART as string,",
                "          SAP_BRAN1 as string,",
                "          SAP_KNA1_AUFSD as string,",
                "          SAP_KNA1_LIFSD as string,",
                "          SAP_KNA1_FAKSD as string,",
                "          SAP_KNVV_AUFSD as string,",
                "          SAP_KNVV_LIFSD as string,",
                "          SAP_KNVV_FAKSD as string,",
                "          SAP_KNA1_LOEVM as string,",
                "          SAP_KNA1_NODEL as string,",
                "          SAP_KNB1_LOEVM as string,",
                "          SAP_KNB1_NODEL as string,",
                "          SAP_KNVV_LOEVM as string,",
                "          SAP_CUSTOMER_COMMENTS as string,",
                "          SAP_KVGR3DATE as timestamp,",
                "          SAP_BAHNS as string,",
                "          SAP_BAHNE as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcLkpSapCustomerMaster",
                "source(output(",
                "          ID as integer,",
                "          MUID as string,",
                "          VersionName as string,",
                "          VersionNumber as integer,",
                "          Version_ID as integer,",
                "          VersionFlag as string,",
                "          Name as string,",
                "          Code as string,",
                "          ChangeTrackingMask as integer,",
                "          SOURCE_SYSTEM_Code as string,",
                "          SOURCE_SYSTEM_Name as string,",
                "          SOURCE_SYSTEM_ID as integer,",
                "          SOURCE_CODE_TYPE as string,",
                "          SOURCE_CODE_VALUE as string,",
                "          DESTINATION_SYSTEM_Code as string,",
                "          DESTINATION_SYSTEM_Name as string,",
                "          DESTINATION_SYSTEM_ID as integer,",
                "          DESTINATION_CODE_TYPE as string,",
                "          DESTINATION_CODE_VALUE as string,",
                "          DESTINATION_OP_CODE_VALUE as string,",
                "          EnterDateTime as timestamp,",
                "          EnterUserName as string,",
                "          EnterVersionNumber as integer,",
                "          LastChgDateTime as timestamp,",
                "          LastChgUserName as string,",
                "          LastChgVersionNumber as integer,",
                "          ValidationStatus as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcLkpSapMaterialGroupMasterXref",
                "source(output(",
                "          ACD as string,",
                "          INVOICE_NUM as string,",
                "          MATERIAL_ID as string,",
                "          INVOICE_CC_INVOICE_YEAR as string,",
                "          INVOICE_MONTH as string,",
                "          INVOICE_DAY as string,",
                "          PACK_BOL_NUM as string,",
                "          PACK_SLIP_NUM as string,",
                "          SHIPPED_CC_SHIPPED_YEAR as string,",
                "          SHIPPED_MONTH as string,",
                "          SHIPPED_DAY as string,",
                "          SHIP_MO as string,",
                "          SHIP_DAY as string,",
                "          SHIP_YEAR as string,",
                "          SHIPPED_TIME as string,",
                "          MS_INTERPLANT as string,",
                "          METH_OF_SHIP as string,",
                "          SCAC_CODE as string,",
                "          SCAC_DESCR as string,",
                "          ROUTE_CODE as string,",
                "          ROUTE_DESCR as string,",
                "          VEHICLE_ID as string,",
                "          P_C_IND as string,",
                "          PREPAID_COLLECT as string,",
                "          MILEAGE as string,",
                "          DISTANCE_UOM as string,",
                "          TOTAL_SHIP_WEIGHT as string,",
                "          UOM_WEIGHT as string,",
                "          MIN_WEIGHT as string,",
                "          MIN_WEIGHT_UOM as string,",
                "          TOTAL_FRT_COST as string,",
                "          FRT_RATE as string,",
                "          FRT_UOM as string,",
                "          ADDTNL_FRT_COST as string,",
                "          ADDTNL_FRT_RATE as string,",
                "          ADDTNL_FRT_UOM as string,",
                "          FRT_COST_SC as string,",
                "          FRT_SC_RATE as string,",
                "          FRT_SC_UOM as string,",
                "          CUST_CODE as string,",
                "          BILL_TO_CUSTOMER as string,",
                "          ORIG_CUST_CODE as string,",
                "          SHIP_FROM_DESCR as string,",
                "          SHIP_FROM_STATE as string,",
                "          SHIP_FROM_CITY as string,",
                "          SHIP_FROM_ZIP_CODE as string,",
                "          SHIP_FROM_COUNTRY as string,",
                "          DEST_CUST_CODE as string,",
                "          SHIP_TO_CUSTOMER as string,",
                "          SHIP_TO_STATE as string,",
                "          SHIP_TO_CITY as string,",
                "          SHIP_TO_ZIP_CODE as string,",
                "          SHIP_TO_COUNTRY as string,",
                "          DATA_SOURCE as string,",
                "          COMPETITIVE_IND as string,",
                "          CONTRACT_RATE as string,",
                "          MILL_ORDER_SPLIT_NO1 as string,",
                "          MS_ORDER_MILL_SPLIT_NO2 as string,",
                "          FACILITY_CODE as string,",
                "          STCC_CODE_OUT as string,",
                "          THICKNESS_MAX as string,",
                "          THICKNESS_UOM as string,",
                "          WIDTH_MAX as string,",
                "          WIDTH_UOM as string,",
                "          LENGTH_MAX as string,",
                "          LENGTH_UOM as string,",
                "          PART_NUMBER as string,",
                "          PART_NUMBER_DESC as string,",
                "          COMMODITY_DESCR as string,",
                "          ITEM_FRT_COST as string,",
                "          MATL_ID_WEIGHT as string,",
                "          MATL_ID_LAST_COIL as string,",
                "          MATL_ID_PRO_AMT as string,",
                "          MATL_ID_SC_AMT as string,",
                "          CUST_FRT as string,",
                "          POSTING_PERIOD as string,",
                "          ITEM_SHIPPED_PIECES as string,",
                "          PROCESSOR_MATL_ID as string,",
                "          OUT_TM_AVAIL_TO_SHIP_DATE as string,",
                "          OUT_TM_LOAD_READY_DATE as string,",
                "          OUT_TM_DATE_SCHD_PICKUP as string,",
                "          OUT_TM_PLN_CARRIER_PICKUP_DTE as string,",
                "          OUT_PLANNED_TRANS_MODE as string,",
                "          OUT_PLANNED_FRT_TYPE_CODE as string,",
                "          OUT_PLANNED_NEXT_SHIP_DATE as string,",
                "          OUT_HEAT_NBR as string,",
                "          ACCT_PROD_CODE as string,",
                "          BETH_SOURCE_CODE as string,",
                "          LINEAL_FT_ENG as string,",
                "          LINEAL_FT_MET as string,",
                "          THEO_WGT_LB as string,",
                "          THEO_WGT_KG as string,",
                "          TIME_ZONE as string,",
                "          SAP_ORDER_NUM as string,",
                "          STATUS as string,",
                "          ACTION as string,",
                "          BOL_NUMBER as string,",
                "          SHIPMENT_DATE as string,",
                "          SOURCE_SYSTEM as string,",
                "          ERROR_FIELDS as string,",
                "          ERROR_MESSAGE as string,",
                "          {_c95} as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcBronzeErr",
                "source(output(",
                "          ID as integer,",
                "          MUID as string,",
                "          VersionName as string,",
                "          VersionNumber as integer,",
                "          Version_ID as integer,",
                "          VersionFlag as string,",
                "          Name as string,",
                "          Code as string,",
                "          ChangeTrackingMask as integer,",
                "          MATERIAL_CODE as string,",
                "          MATERIAL_GROUP_CODE as string,",
                "          MATERIAL_GROUP_DESCRITPION as string,",
                "          PRODUCTS_TO_SAP_IND as string,",
                "          EnterDateTime as timestamp,",
                "          EnterUserName as string,",
                "          EnterVersionNumber as integer,",
                "          LastChgDateTime as timestamp,",
                "          LastChgUserName as string,",
                "          LastChgVersionNumber as integer,",
                "          ValidationStatus as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcSapPrimeLFR",
                "source(output(",
                "          carrier_id as string,",
                "          carrier_name as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     format: 'parquet') ~> SrcTruckRailRouteDesc",
                "CastToString derive(SCAC_CODE = iif(TRANSPORTATION_MODE_CODE == \"TRUCK\",SCAC_Code,CARRIER_CODE),",
                "          OVER_DIMENSIONAL = $OVER_DIMENSIONAL,",
                "          CREATED_DATE = /* toString(currentUTC(),\"MM/dd/yyyy HH:mm:ss\") */\r",
                "toString($CreatedDateOds),",
                "          LAST_UPDATED_DATE = /* toString(currentUTC(),\"MM/dd/yyyy HH:mm:ss\") */\r",
                "toString($CreatedDateOds),",
                "          RAIL_ROUTE_CODE = iif(TRANSPORTATION_MODE_CODE==\"RAIL\",ROUTE_CODE,toString(null())),",
                "          RAIL_ROUTE_FULL_DESC = RAIL_ROUTE_FULL_DESC,",
                "          SUB_COMMODITY = iif( SHIP_FROM_TYPE==\"OP\",CacheSnkSapMaterialGroupXref#lookup(\"ACCT_CLASS_CODE\",\"SAP\",\"MATERIAL_GROUP_CODE\",upper(trim(ACCT_PROD))).DESTINATION_OP_CODE_VALUE,\r",
                "CacheSnkSapMaterialGroupXref#lookup(\"ACCT_CLASS_CODE\",\"SAP\",\"MATERIAL_GROUP_CODE\",upper(trim(ACCT_PROD))).DESTINATION_CODE_VALUE),",
                "          {Freight Source Type} = SOURCE_SYSTEM,",
                "          CURRENCY = 'USD',",
                "          MINIMUM_RATE = toString(null()),",
                "          RATE_AUTHORITY = toString(null()),",
                "          PTMX_LOAD_NUMBER = toString(null()),",
                "          FUEL_SURCHARGE_AGREEMENT_CODE = toString(null()),",
                "          MATL_ID_WEIGHT_NUMERIC = toFloat(MATL_ID_WEIGHT),",
                "          DISTANCE_MILAGE = iif(equals(DISTANCE_UOM, 'MILES'), MILEAGE, toString(null())),",
                "          BILL_TO_CUSTOMER_ID = substring(CUST_CODE, 0, 6),",
                "          CUSTOMER_SUFFIX = substring(CUST_CODE, 8, 9),",
                "          PURCHASE_ORDER_NUMBER = toString(null()),",
                "          VENDOR_NUMBER = toString(null()),",
                "          CUSTOMER_PLANT_ID = toString(null()),",
                "          PRODUCT_DESC = toString(null()),",
                "          OWNING_PLANT_ID = toString(null())) ~> DerivedCols",
                "SplitOnErrors@ErrorRows derive(each(match(name!=\"SHIP_FROM_LOCATION_ID\"&&name!=\"SHIP_TO_LOCATION_ID\"&&name!=\"SCAC_CODE\"&&name!=\"TRANSPORTATION_MODE_CODE\"&&name!=\"PAYMENT_TYPE\"&&name!=\"CUSTOMER_PART\"&&name!=\"SAP_ORDER_NUMBER\"&&name!=\"LEGACY_ORDER_NUMBER \"&&name!=\"EQUIPMENT_TYPE\"&&name!=\"SAP_KUNNR\"&&name!=\"PLANT_ID\"&&name!=\"RAIL_ROUTE_CODE\"&&name!=\"RAIL_ROUTE_FULL_DESC\"&&name!=\"SHIPMENT_TIME\"&&name!=\"FINISH_CODE\"&&name!=\"SHIP_TO_STATION_CITY\"&&name!=\"SHIP_TO_STATION_STATE\"&&name!=\"SUB_COMMODITY\"&&name!=\"VEHICLE_PREFIX\"&&name!=\"VEHICLE_ID\"&&name!=\"MATL_ID_WEIGHT_NUMERIC\"&&name!=\"SHIP_TO_TYPE\"&&name!=\"ITEM_SHIPPED_PIECES\"&&name!='BOL_FREIGHT_WEIGHT'&&name!='SAP_ORDER_NUMBER'&&name!='INTERNAL_SHIPMENT'&&name!='CARRIER_CODE'&&name!=\"LkpSapPlantmaster\"&&name!=\"LkpSapCustomerMaster\"), concat($$,\"_ERROR\") = iif(isNull($$),concat($0,\" cannot be null\"), iif(trim($$) == \"\",concat($0,\" cannot be empty\"),toString(null())))),",
                "          SHIP_FROM_LOCATION_ID_ERROR = iif(isNull(ORIG_CUST_CODE) || trim(ORIG_CUST_CODE) == \"\",toString(null()),iif(isNull(SHIP_FROM_LOCATION_ID),concat(\"ORIG_CUST_CODE value is invalid: ORIG_CUST_CODE=\",ORIG_CUST_CODE,\" | Lookup File Name = SAP_LEGACY_PLANT_XREF\"),toString(null()))),",
                "          SHIP_TO_LOCATION_ID_ERROR = iif(isNull(DEST_CUST_CODE) || trim(DEST_CUST_CODE) == \"\",toString(null()),iif(isNull(SHIP_TO_LOCATION_ID),concat(\"DEST_CUST_CODE value is invalid: DEST_CUST_CODE=\",DEST_CUST_CODE,\" | Lookup File Name = SAP_LEGACY_MASTER_XREF/SAP_LEGACY_PLANT_XREF\"),toString(null()))),",
                "          TRANSPORTATION_MODE_CODE_ERROR = iif(isNull(METH_OF_SHIP) || trim(METH_OF_SHIP) == \"\",toString(null()),iif(isNull(TRANSPORTATION_MODE_CODE),concat(\"METH_OF_SHIP value is invalid: METH_OF_SHIP=\",METH_OF_SHIP,\" | Lookup File Name = ODS_REF_MASTER_XREF\"),toString(null()))),",
                "          LkpSapPlantMaster_ERROR = iif(isNull(SHIP_FROM_LOCATION_ID) || trim(SHIP_FROM_LOCATION_ID)=='','',iif(isNull(LkpSapPlantmaster),\"SHIP_FROM_LOCATION_ID is invalid in SAP_PLANT_MASTER and SAP_CUSTOMER_MASTER,\",'')),",
                "          LkpSapCustomerMaster_ERROR = iif(isNull(SHIP_TO_LOCATION_ID) || trim(SHIP_TO_LOCATION_ID)=='','',iif(isNull(LkpSapCustomerMaster),\"SHIP_TO_LOCATION_ID is invalid in SAP_PLANT_MASTER and SAP_CUSTOMER_MASTER,\",'')),",
                "          SCAC_CODE_ERROR = iif(TRANSPORTATION_MODE_CODE == \"TRUCK\", iif(isNull(SCAC_CODE) || trim(SCAC_CODE)==\"\",\"SCAC_CODE cannot be null\",toString(null())),toString(null())),",
                "          CARRIER_CODE_ERROR = iif((trim(TRANSPORTATION_MODE_CODE) == \"RAIL\" || trim(TRANSPORTATION_MODE_CODE) == \"BARGE\" ), \r",
                "iif(isNull(SCAC_CODE) || trim(SCAC_CODE)==\"\",\"SCAC_CODE cannot be null\",toString(null())),toString(null())),",
                "          RAIL_ROUTE_FULL_DESC_ERROR = iif(TRANSPORTATION_MODE_CODE == \"RAIL\",\r",
                "iif(isNull(ROUTE_DESCR) || trim(ROUTE_DESCR) == \"\",\"ROUTE_DESCR cannot be null\",\r",
                "iif(isNull(RAIL_ROUTE_FULL_DESC),concat(\"ROUTE_DESCR value is invalid: ROUTE_DESCR=\",ROUTE_DESCR,\" | Lookup File Name = ODS_REF_MASTER_XREF\"),toString(null()))),\r",
                "iif(TRANSPORTATION_MODE_CODE == \"TRUCK\",iif(isNull(SCAC_CODE) || trim(SCAC_CODE) == \"\",\"SCAC CODE cannot be null\",\r",
                "iif(isNull(RAIL_ROUTE_FULL_DESC),concat(\"SCAC_CODE value is invalid: SCAC_CODE=\",SCAC_CODE,\" | Lookup File Name = TRUCK_RAIL_ROUTE\"),toString(null()))),toString(null()))),",
                "          PAYMENT_TYPE_ERROR = iif(isNull(P_C_IND) || trim(P_C_IND) == \"\",toString(null()),iif(isNull(PAYMENT_TYPE),concat(\"P_C_IND value is invalid: P_C_IND=\",P_C_IND,\" | Lookup File Name = ODS_REF_MASTER_XREF\"),toString(null()))),",
                "          SAP_KUNNR_ERROR = iif(isNull(SHIP_TO_LOCATION_ID),toString(null()),iif(isNull(SAP_KUNNR),concat(\"SHIP_TO_LOCATION_ID is invalid in SAP_CUSTOMER_MASTER: SHIP_TO_LOCATION_ID=\",SHIP_TO_LOCATION_ID),toString(null()))),",
                "          PLANT_ID_ERROR = iif(isNull(SHIP_FROM_LOCATION_ID),toString(null()),iif(isNull(PLANT_ID),concat(\"SHIP_FROM_LOCATION_ID is invalid in SAP_PLANT_MASTER: SHIP_FROM_LOCATION_ID=\",SHIP_FROM_LOCATION_ID),toString(null()))),",
                "          RAIL_ROUTE_CODE_ERROR = iif(TRANSPORTATION_MODE_CODE == \"RAIL\", iif(isNull(ROUTE_CODE) || trim(ROUTE_CODE)==\"\",\"ROUTE_CODE cannot be null\",toString(null())),toString(null())),",
                "          VEHICLE_PREFIX_ERROR = iif(TRANSPORTATION_MODE_CODE == \"RAIL\" && VECHICLE_PREFIX_CALC==\"E\",\"VEHICLE_ID cannot be null\",toString(null())),",
                "          VEHICLE_ID_ERROR = iif(TRANSPORTATION_MODE_CODE == \"RAIL\" && VECHICLE_ID_CALC==\"E\",\"VEHICLE_ID cannot be null\",toString(null())),",
                "          SHIP_TO_TYPE_ERROR = iif(isNull(MS_INTERPLANT) || trim(MS_INTERPLANT) == \"\",toString(null()),iif(isNull(SHIP_TO_TYPE),concat(\"MS_INTERPLANT value is invalid: MS_INTERPLANT=\",MS_INTERPLANT),toString(null())))) ~> ErrorFields",
                "derivedColumn19 split(isNull(BOL_NUMBER) || trim(BOL_NUMBER) == \"\" ||  isNull(SHIPMENT_DATE) || trim(SHIPMENT_DATE) == \"\" ||  isNull(TRANSPORTATION_MODE_CODE) || isNull(METH_OF_SHIP)\r",
                " ||  isNull(SHIPMENT_TIME) || trim(SHIPMENT_TIME) == \"\"  ||  \r",
                "isNull(MS_ORDER_MILL_SPLIT_NO2) || trim(MS_ORDER_MILL_SPLIT_NO2)==\"\"||\r",
                "isNull(ORIG_CUST_CODE) || trim(ORIG_CUST_CODE)==\"\"|| isNull(SHIP_FROM_LOCATION_ID) ||  \r",
                "isNull(TIME_ZONE) ||\r",
                "isNull(DEST_CUST_CODE) || trim(DEST_CUST_CODE)==\"\"||\r",
                "iif(!startsWith(upper(trim(MS_ORDER_MILL_SPLIT_NO2)), \"E\") , \r",
                "iif(isNull(OUT_HEAT_NBR)||trim(OUT_HEAT_NBR)==\"\",true(),false()),false())||\r",
                "isNull(SHIP_TO_LOCATION_ID) || \r",
                "isNull(LkpSapPlantmaster)|| isNull(LkpSapCustomerMaster)\r",
                "|| isNull(P_C_IND) || isNull(PAYMENT_TYPE) ||\r",
                "CARRIER_CODE_CALC==\"E\" || \r",
                " isNull(BOL_WEIGHT)  || isNull(BOL_WEIGHT_UOM) \r",
                "|| RAIL_ROUTE_CODE_CALC ==\"E\" || RAIL_ROUTE_FULL_DESC ==\"E\"|| SCAC_CALC ==\"E\" \r",
                "|| isNull(MATERAIL_ID) || trim(MATERAIL_ID)==\"\" || isNull(ITEM_WEIGHT) ||  isNull(ITEM_WEIGHT_UOM) \r",
                "|| isNull(ITEM_COUNT) || \r",
                "\r",
                "/* isNull(COMMODITY) || */\r",
                " isNull(SAP_KUNNR) ||  isNull(PLANT_ID) \r",
                " || VECHICLE_PREFIX_CALC==\"E\"||VECHICLE_ID_CALC==\"E\"  ||\r",
                "isNull(CUST_CODE) || trim(CUST_CODE)==\"\"  || \r",
                "isNull(MS_INTERPLANT) || trim(MS_INTERPLANT)==\"\" || isNull(SHIP_TO_TYPE) || trim(SHIP_TO_TYPE)==\"\" ||\r",
                " /* isNull(BETH_SOURCE_CODE) || trim(BETH_SOURCE_CODE)==\"\" || */\r",
                "iif(THICKNESS_UOM=='IN'||THICKNESS_UOM=='MM', isNull(THICKNESS_MAX) || trim(THICKNESS_MAX)==\"\", false())||\r",
                "iif(WIDTH_UOM=='IN'||WIDTH_UOM=='MM', isNull(WIDTH_MAX) || trim(WIDTH_MAX)==\"\", false())||\r",
                "iif(LENGTH_UOM=='IN'||LENGTH_UOM=='MM', isNull(LENGTH_MAX) || trim(LENGTH_MAX)==\"\", false())||\r",
                "\r",
                "iif(PAYMENT_TYPE=='P' && TRIP_TITLE=='0',\r",
                "isNull(BOL_WEIGHT_UOM) || trim(BOL_WEIGHT_UOM)==\"\" \r",
                "|| isNull(MATL_ID_WEIGHT) || trim(MATL_ID_WEIGHT)==\"\" ||\r",
                " /* isNull(LOAD_NUMBER) ||  trim(LOAD_NUMBER)==\"\" || */\r",
                "isNull(DISTANCE_UOM) ||  trim(DISTANCE_UOM)==\"\" \r",
                "\r",
                ", false()),",
                "     disjoint: false) ~> SplitOnErrors@(ErrorRows, ProperRows)",
                "ErrorFields derive(ERROR_FIELDS = rtrim(iif(!isNull(FACILITY_CODE_ERROR), \"FACILITY_CODE_ERROR,\", \"\")+iif(!isNull(BOL_NUMBER_ERROR), \"PACK_BOL_NUM,\", \"\") +  iif(!isNull(SHIPMENT_DATE_ERROR), \"Shipped_CC/Shipped_YY/SHIPPED_MONTH/SHIPPED_DAY,\", \"\")  \r",
                "+iif(!isNull(MS_ORDER_MILL_SPLIT_NO2_ERROR), \"MS_ORDER_MILL_SPLIT_NO2,\", \"\")\r",
                "+iif(!isNull(METH_OF_SHIP_ERROR), \"METH_OF_SHIP,\", \"\")  +iif(!isNull(TRANSPORTATION_MODE_CODE_ERROR), \"METH_OF_SHIP,\", \"\") + \r",
                "iif(!isNull(DEST_CUST_CODE_ERROR), \"DEST_CUST_CODE,\", \"\") +\r",
                "iif(!isNull(SHIP_TO_LOCATION_ID_ERROR), \"DEST_CUST_CODE,\", \"\")  +iif(!isNull(ORIG_CUST_CODE_ERROR), \"ORIG_CUST_CODE,\", \"\") +  iif(!isNull(SHIP_FROM_LOCATION_ID_ERROR), \"ORIG_CUST_CODE,\", \"\")  + iif(!isNull(P_C_IND_ERROR), \"P_C_IND,\", \"\") +iif(!isNull(PAYMENT_TYPE_ERROR), \"P_C_IND,\", \"\") \r",
                "+ iif(LkpSapPlantMaster_ERROR!='', \"SHIP_FROM_LOCATION_ID,\", \"\") \r",
                "+ iif(LkpSapCustomerMaster_ERROR!='', \"SHIP_TO_LOCATION_ID,\", \"\") \r",
                "+ iif(!isNull(CARRIER_CODE_ERROR), \"SCAC_CODE,\", \"\") \r",
                "+ iif(!isNull(VEHICLE_PREFIX_ERROR), \"VEHICLE_ID,\", \"\")+iif(!isNull(VEHICLE_PREFIX_ERROR), \"\",iif(!isNull(VEHICLE_ID_ERROR),\"VEHICLE_ID,\",\"\")) \r",
                "+iif(!isNull(BOL_WEIGHT_ERROR), \"TOTAL_SHIP_WEIGHT,\", \"\")+iif(!isNull(BOL_WEIGHT_UOM_ERROR), \"UOM_WEIGHT,\", \"\") + iif(!isNull(RAIL_ROUTE_CODE_ERROR), \"ROUTE_CODE,\", \"\")+  iif(TRANSPORTATION_MODE_CODE=='RAIL',iif(!isNull(RAIL_ROUTE_FULL_DESC_ERROR), \"ROUTE_DESCR,\", \"\"), iif(TRANSPORTATION_MODE_CODE=='TRUCK',iif(!isNull(RAIL_ROUTE_FULL_DESC_ERROR), \"SCAC_CODE,\", \"\"),''))+\r",
                "iif(!isNull(SCAC_CODE_ERROR), \"SCAC_CODE,\", \"\")+iif(!isNull(MATERAIL_ID_ERROR), \"MATERIAL_ID ,\", \"\") +\r",
                "iif(THICKNESS_UOM=='IN'||THICKNESS_UOM=='MM',iif(isNull(THICKNESS_MAX) || trim(THICKNESS_MAX)==\"\",'THICKNESS_MAX',''),'') +\r",
                "iif(WIDTH_UOM=='IN'||WIDTH_UOM=='MM',iif(isNull(WIDTH_MAX) || trim(WIDTH_MAX)==\"\",'WIDTH_MAX',''),'') +\r",
                "iif(LENGTH_UOM=='IN'||LENGTH_UOM=='MM',iif(isNull(LENGTH_MAX) || trim(LENGTH_MAX)==\"\",'LENGTH_MAX',''),'')\r",
                "/* +iif(!isNull(THICKNESS_MAX_ERROR), \"THICKNESS_MAX ,\", \"\")+iif(!isNull(WIDTH_MAX_ERROR), \"WIDTH_MAX ,\", \"\")+iif(!isNull(LENGTH_MAX_ERROR), \"LENGTH_MAX ,\", \"\") */\r",
                "+iif(!isNull(ITEM_WEIGHT_ERROR), \"MATL_ID_WEIGHT,\", \"\") +\r",
                "iif(!startsWith(upper(trim(MS_ORDER_MILL_SPLIT_NO2)), \"E\"), \r",
                "iif(!isNull(OUT_HEAT_NBR_ERROR),\"OUT_HEAT_NBR,\",\"\"),\"\")+\r",
                "iif(!isNull(ITEM_WEIGHT_UOM_ERROR), \"UOM_WEIGHT,\", \"\") + \r",
                "iif(!isNull(TIME_ZONE_ERROR), \"TIME_ZONE,\", \"\") \r",
                "/* +iif(!isNull(COMMODITY_ERROR), \"COMMODITY,\", \"\") */\r",
                "+ iif(!isNull(SAP_KUNNR_ERROR), \"SAP_KUNNR,\", \"\") +  iif(!isNull(PLANT_ID_ERROR), \"PLANT_ID,\", \"\") +\r",
                "\r",
                "iif(!isNull(CUST_CODE_ERROR), \"CUST_CODE,\", \"\") + \r",
                "/* iif(!isNull(BETH_SOURCE_CODE_ERROR), \"BETH_SOURCE_CODE,\", \"\") + */\r",
                "iif(!isNull(MS_INTERPLANT_ERROR), \"MS_INTERPLANT,\", \"\") +\r",
                "iif(!isNull(SHIP_TO_TYPE_ERROR), \"SHIP_TO_TYPE,\", \"\") +\r",
                "iif(PAYMENT_TYPE == \"P\" && TRIP_TITLE=='0',\r",
                "iif(!isNull(BOL_WEIGHT_UOM_ERROR), \"UOM_WEIGHT,\", \"\") + \r",
                "iif(!isNull(MATL_ID_WEIGHT_ERROR), \"MATL_ID_WEIGHT,\", \"\") +\r",
                "/* iif(!isNull(LOAD_NUMBER_ERROR), \"LOAD_NUMBER,\", \"\") +  */\r",
                "iif(!isNull(DISTANCE_UOM_ERROR), \"DISTANCE_UOM,\", \"\"),  \"\") \r",
                ", \",\"),",
                "          ERROR_MESSAGES_CALC = rtrim(iif(!isNull(FACILITY_CODE_ERROR), concat(FACILITY_CODE_ERROR, \",\"), \"\")+iif(!isNull(BOL_NUMBER_ERROR), concat(BOL_NUMBER_ERROR, \",\"), \"\") +  iif(!isNull(SHIPMENT_DATE_ERROR), concat(SHIPMENT_DATE_ERROR, \",\"), \"\") +  iif(!isNull(TRANSPORTATION_MODE_CODE_ERROR), concat(TRANSPORTATION_MODE_CODE_ERROR, \",\"), \"\") \r",
                "+ iif(!isNull(MS_ORDER_MILL_SPLIT_NO2_ERROR), concat(MS_ORDER_MILL_SPLIT_NO2_ERROR, \",\"), \"\")\r",
                "+ iif(!isNull(METH_OF_SHIP_ERROR), concat(METH_OF_SHIP_ERROR, \",\"), \"\") +iif(!isNull(ORIG_CUST_CODE_ERROR), concat(ORIG_CUST_CODE_ERROR, \",\"), \"\") +iif(!isNull(SHIP_FROM_LOCATION_ID_ERROR), concat(SHIP_FROM_LOCATION_ID_ERROR, \",\"), \"\")+\r",
                "iif(!isNull(DEST_CUST_CODE_ERROR), concat(DEST_CUST_CODE_ERROR, \",\"), \"\") +   \r",
                "iif(!isNull(SHIP_TO_LOCATION_ID_ERROR), concat(SHIP_TO_LOCATION_ID_ERROR, \",\"), \"\") +\r",
                "iif(LkpSapPlantMaster_ERROR!='', concat(LkpSapPlantMaster_ERROR, \",\"), \"\") +\r",
                "iif(LkpSapCustomerMaster_ERROR!='', concat(LkpSapCustomerMaster_ERROR, \",\"), \"\") +\r",
                "iif(!isNull(P_C_IND_ERROR), concat(P_C_IND_ERROR, \",\"), \"\") +  iif(!isNull(PAYMENT_TYPE_ERROR), concat(PAYMENT_TYPE_ERROR, \",\"), \"\") +  \r",
                "iif(!isNull(CARRIER_CODE_ERROR), concat(CARRIER_CODE_ERROR, \",\"), \"\") + \r",
                "iif(!startsWith(upper(trim(MS_ORDER_MILL_SPLIT_NO2)), \"E\"), \r",
                "iif(!isNull(OUT_HEAT_NBR_ERROR),concat(OUT_HEAT_NBR_ERROR, \",\"),\"\"),\"\")+\r",
                " iif(!isNull(VEHICLE_PREFIX_ERROR), concat(VEHICLE_PREFIX_ERROR, \",\"), \"\") + iif(!isNull(VEHICLE_PREFIX_ERROR), \"\",iif(!isNull(VEHICLE_ID_ERROR),concat(VEHICLE_ID_ERROR, \",\"),\"\")) + \r",
                " iif(!isNull(SAP_KUNNR_ERROR), concat(SAP_KUNNR_ERROR, \",\"), \"\") +  iif(!isNull(PLANT_ID_ERROR), concat(PLANT_ID_ERROR, \",\"), \"\")  \r",
                " +  iif(!isNull(BOL_WEIGHT_ERROR), concat(TOTAL_SHIP_WEIGHT_ERROR, \",\"), \"\") +    iif(!isNull(BOL_WEIGHT_UOM_ERROR), concat(BOL_WEIGHT_UOM_ERROR, \",\"), \"\") \r",
                " +  iif(!isNull(RAIL_ROUTE_CODE_ERROR), concat(RAIL_ROUTE_CODE_ERROR, \",\"), \"\") +  iif(!isNull(RAIL_ROUTE_FULL_DESC_ERROR), concat(RAIL_ROUTE_FULL_DESC_ERROR, \",\"), \"\")\r",
                "+iif(!isNull(SCAC_CODE_ERROR), concat(SCAC_CODE_ERROR, \",\"), \"\") +    iif(!isNull(MATERAIL_ID_ERROR), concat(MATERAIL_ID_ERROR, \",\"), \"\")+\r",
                "iif(THICKNESS_UOM=='IN'||THICKNESS_UOM=='MM', iif(!isNull(THICKNESS_MAX_ERROR), THICKNESS_MAX_ERROR,''), '') +\r",
                "iif(WIDTH_UOM=='IN'||WIDTH_UOM=='MM', iif(!isNull(WIDTH_MAX_ERROR), WIDTH_MAX_ERROR,''), '') +\r",
                "iif(LENGTH_UOM=='IN'||LENGTH_UOM=='MM', iif(!isNull(LENGTH_MAX_ERROR), LENGTH_MAX_ERROR,''), '')\r",
                "/* +    iif(!isNull(THICKNESS_MAX_ERROR), concat(THICKNESS_MAX_ERROR, \",\"), \"\") +    iif(!isNull(WIDTH_MAX_ERROR), concat(WIDTH_MAX_ERROR, \",\"), \"\") +  iif(!isNull(LENGTH_MAX_ERROR), concat(LENGTH_MAX_ERROR, \",\"), \"\") */\r",
                "+iif(!isNull(ITEM_WEIGHT_ERROR), concat(ITEM_WEIGHT_ERROR, \",\"), \"\") +  iif(!isNull(ITEM_WEIGHT_UOM_ERROR), concat(UOM_WEIGHT_ERROR, \",\"), \"\")  + \r",
                " /* iif(!isNull(COMMODITY_ERROR), concat(COMMODITY_ERROR, \",\"), \"\") + */\r",
                "iif(!isNull(CUST_CODE_ERROR), concat(CUST_CODE_ERROR, \",\"), \"\") + \r",
                "/* iif(!isNull(BETH_SOURCE_CODE_ERROR), concat(BETH_SOURCE_CODE_ERROR, \",\"), \"\") + */\r",
                "iif(!isNull(MS_INTERPLANT_ERROR), concat(MS_INTERPLANT_ERROR, \",\"), \"\") +\r",
                "iif(!isNull(SHIP_TO_TYPE_ERROR), concat(SHIP_TO_TYPE_ERROR, \",\"), \"\") +\r",
                "\r",
                "iif(PAYMENT_TYPE == \"P\" && TRIP_TITLE == '0',\r",
                "iif(!isNull(BOL_WEIGHT_UOM_ERROR), concat(UOM_WEIGHT_ERROR, \",\"), \"\") + \r",
                "iif(!isNull(MATL_ID_WEIGHT_ERROR), concat(MATL_ID_WEIGHT_ERROR, \",\"), \"\") +\r",
                "/* iif(!isNull(LOAD_NUMBER_ERROR), concat(LOAD_NUMBER_ERROR, \",\"), \"\") +  */\r",
                "iif(!isNull(DISTANCE_UOM_ERROR), concat(DISTANCE_UOM_ERROR, \",\"), \"\") \r",
                "\r",
                ", \"\"),\",\"),",
                "          ERROR_FLAG = \"Y\") ~> ErrorFieldsAggregation",
                "SrcLkpLegacyMasterXref filter(upper(LEGACY_SYSTEM)== \"EDS LEGACY\" && upper(SAP_PARVW)==\"WE\") ~> FtrEdsLegacy",
                "SrcLkpOdsRefMasterXref filter(upper(SOURCE_SYSTEM_Name)==\"BETH\") ~> FtrBhLfr",
                "SrcLkpLegacyPlantXref filter(upper(SAP_SOURCE_SYSTEM_Name)==upper(\"BETH\") || upper(SAP_SOURCE_SYSTEM_Name)==upper(\"EASTERN PLATES\")) ~> FtrBeth",
                "UnionSrcErr select(mapColumn(",
                "          PACK_BOL_NUM,",
                "          FACILITY_CODE,",
                "          SHIPPED_CC_SHIPPED_YEAR,",
                "          SHIPPED_MONTH,",
                "          SHIPPED_DAY,",
                "          SHIPPED_TIME,",
                "          METH_OF_SHIP,",
                "          ORIG_CUST_CODE,",
                "          DEST_CUST_CODE,",
                "          P_C_IND,",
                "          SCAC_Code = SCAC_CODE,",
                "          VEHICLE_ID,",
                "          TOTAL_SHIP_WEIGHT,",
                "          ROUTE_CODE,",
                "          ROUTE_DESCR,",
                "          MATERIAL_ID,",
                "          OUT_HEAT_NBR,",
                "          THICKNESS_MAX,",
                "          THICKNESS_UOM,",
                "          WIDTH_MAX,",
                "          WIDTH_UOM,",
                "          LENGTH_UOM,",
                "          LENGTH_MAX,",
                "          MATL_ID_WEIGHT,",
                "          ITEM_SHIPPED_PIECES,",
                "          MS_ORDER_MILL_SPLIT_NO2,",
                "          STCC_CODE_OUT,",
                "          ACCT_PROD_CODE,",
                "          MILL_ORDER_SPLIT_NO1,",
                "          PART_NUMBER,",
                "          FRT_COST_SC,",
                "          ADDTNL_FRT_COST,",
                "          UOM_WEIGHT,",
                "          MINIMUM_WEIGHT = MIN_WEIGHT,",
                "          DISTANCE_UOM,",
                "          MILEAGE,",
                "          FRT_SC_RATE,",
                "          FRT_RATE,",
                "          ADDTNL_FRT_RATE,",
                "          FRT_SC_UOM,",
                "          FRT_UOM,",
                "          ADDTNL_FRT_UOM,",
                "          MATL_ID_SC_AMT,",
                "          ITEM_FRT_COST,",
                "          MATL_ID_PRO_AMT,",
                "          MINIMUM_WEIGHT = MIN_WEIGHT,",
                "          CUST_CODE,",
                "          BETH_SOURCE_CODE,",
                "          MS_INTERPLANT,",
                "          LINEAL_FT_ENG,",
                "          LINEAL_FT_MET,",
                "          THEO_WGT_LB,",
                "          THEO_WGT_KG,",
                "          TIME_ZONE,",
                "          SAP_ORDER_NUM,",
                "          PROCESSOR_MATL_ID,",
                "          CUST_FRT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> SelectReqClmns",
                "derivedColumn10 derive(each(match(name!=\"Shipment_Date\"), $$ = trim(toString($$)))) ~> CastToString",
                "ErrorFieldsAggregation select(mapColumn(",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          LOAD_NUMBER,",
                "          TRANSPORTATION_MODE_CODE,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_LOCATION_NAME1,",
                "          SHIP_FROM_LOCATION_NAME2,",
                "          SHIP_FROM_LOCATION_ADDRESS,",
                "          SHIP_FROM_LOCATION_CITY,",
                "          SHIP_FROM_LOCATION_STATE,",
                "          SHIP_FROM_LOCATION_COUNTRY,",
                "          SHIP_FROM_LOCATION_ZIPCODE,",
                "          SHIP_TO_LOCATION_ID,",
                "          SHIP_TO_LOCATION_NAME1,",
                "          SHIP_TO_LOCATION_NAME2,",
                "          SHIP_TO_LOCATION_ADDRESS,",
                "          SHIP_TO_LOCATION_CITY,",
                "          SHIP_TO_LOCATION_STATE,",
                "          SHIP_TO_LOCATION_COUNTRY,",
                "          SHIP_TO_LOCATION_ZIPCODE,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SHIP_TO_STATION_CITY,",
                "          SHIP_TO_STATION_STATE,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          CONTROL_LOCATION_ID = SHIP_FROM_LOCATION_ID,",
                "          PAYMENT_TYPE,",
                "          CARRIER_CODE,",
                "          VEHICLE_PREFIX,",
                "          VEHICLE_ID,",
                "          BOL_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          RAIL_ROUTE_CODE,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SCAC_CODE,",
                "          MATERIAL_ID = MATERAIL_ID,",
                "          ENG_GAUGE = DIM_GAUGE_ENG,",
                "          MET_GAUGE = {DIM_GAUGE_MET },",
                "          ENG_WIDTH = DIM_WIDTH_ENG,",
                "          MET_WIDTH = DIM_WIDTH_MET,",
                "          ENG_LENGTH = DIM_LENGTH_ENG,",
                "          MET_LENGTH = DIM_LENGTH_MET,",
                "          ITEM_WEIGHT,",
                "          ITEM_WEIGHT_UOM,",
                "          OVER_DIMENSIONAL,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          COMMODITY,",
                "          SUB_COMMODITY,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          HEAT_NUMBER,",
                "          CUSTOMER_PART_NO = CUSTOMER_PART,",
                "          ERROR_FLAG,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGES_CALC,",
                "          CREATED_DATE,",
                "          LAST_UPDATED_DATE,",
                "          SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          FINISH_CODE,",
                "          FREIGHT_SOURCE_SYSTEM = {Freight Source Type},",
                "          CHARGE_TYPE,",
                "          PTMX_LOAD_NUMBER,",
                "          LOAD_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          MINIMUM_RATE,",
                "          DISTANCE_MILAGE,",
                "          RATE_AUTHORITY,",
                "          CHARGE_TYPE_DESC,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          CHARGE_RATE,",
                "          CHARGE_RATE_UOM,",
                "          CURRENCY,",
                "          CHARGE_AMOUNT,",
                "          PRODUCT_CODE,",
                "          PRODUCT_DESC,",
                "          BILL_TO_CUSTOMER_ID,",
                "          AP_SHIP_TO_TYPE,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          OWNING_PLANT_ID,",
                "          PROCESSOR_PIECE_ID,",
                "          SKID,",
                "          THEO_WEIGHT_LB,",
                "          THEO_WEIGHT_KG,",
                "          SHIPMENT_HEADER_COMMENTS,",
                "          MISC_COMMENTS_ITEM,",
                "          LINEAL_FEET_MT,",
                "          LINEAL_FEET_ENG,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          IS_PRIME_LFR,",
                "          SOURCE_BOL_NUMBER,",
                "          CARRIER_NAME,",
                "          TRIP_TITLE,",
                "          {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          ITEM_FREIGHT_WEIGHT,",
                "          BOL_FREIGHT_WEIGHT,",
                "          INTERNAL_SHIPMENT,",
                "          TIMEZONE = TIME_ZONE",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> SelectErrorFields",
                "derivedColumn1 derive(SHIPMENT_DATE = concat(SHIPPED_MONTH,'/',SHIPPED_DAY,'/',SHIPPED_CC_SHIPPED_YEAR),",
                "          SHIPMENT_TIME = iif( !isNull(SHIPPED_TIME) && trim(SHIPPED_TIME)!=\"\", replace(SHIPPED_TIME,'.',':'),\"00:00:00\"),",
                "          SOURCE_BOL_NUMBER = PACK_BOL_NUM,",
                "          SOURCE_LOAD_NUMBER = PACK_BOL_NUM,",
                "          CARRIER_NAME = toString(null()),",
                "          SHIP_FROM_LOCATION_ID = iif((FACILITY_CODE=='54'|| FACILITY_CODE == '55'),SnkLegacyPlantXref#lookup(ORIG_CUST_CODE,'BETH').SAP_PLANT_ID,\r",
                "iif((FACILITY_CODE=='58' || FACILITY_CODE =='59'),SnkLegacyPlantXref#lookup(ORIG_CUST_CODE,'EASTERN PLATES').SAP_PLANT_ID,'')),",
                "          SHIP_TO_LOCATION_ID = iif(FACILITY_CODE==\"54\",:Ship_to_lfr,:Ship_to_plates_EP),",
                "          COMMODITY = iif(FACILITY_CODE==\"54\",:Commodity_lfr,iif(FACILITY_CODE==\"55\",:Commodity_plates,:Commodity_Ep)),",
                "          DIM_GAUGE_ENG = iif(THICKNESS_UOM=='IN',THICKNESS_MAX,toString(null())),",
                "          {DIM_GAUGE_MET } = iif(THICKNESS_UOM=='MM',THICKNESS_MAX,toString(null())),",
                "          DIM_WIDTH_ENG = iif(WIDTH_UOM=='IN',WIDTH_MAX,toString(null())),",
                "          DIM_WIDTH_MET = iif(WIDTH_UOM=='MM',WIDTH_MAX,toString(null())),",
                "          DIM_LENGTH_ENG = iif(LENGTH_UOM=='IN',LENGTH_MAX,toString(null())),",
                "          DIM_LENGTH_MET = iif(LENGTH_UOM=='MM',LENGTH_MAX,toString(null())),",
                "          VEHICLE_PREFIX = regexExtract(VEHICLE_ID,'([A-Z a-z]+)',1),",
                "          TRANSPORTATION_MODE_CODE = iif(upper(trim(METH_OF_SHIP))=='TITLE','TITLE',SnkOdsRefMasterXrefCache#lookup(\"BETH\",\"METH-OF-SHIP\",\"ODS\",\"TRANSPORTATION_MODE_CODE\",upper(trim(METH_OF_SHIP))).DESTINATION_CODE_VALUE),",
                "          PAYMENT_TYPE = SnkOdsRefMasterXrefCache#lookup(\"BETH\",\"P-C-IND\",\"ODS\",\"PAYMENT_TYPE\",upper(trim(P_C_IND))).DESTINATION_CODE_VALUE,",
                "          BOL_WEIGHT = TOTAL_SHIP_WEIGHT,",
                "          ITEM_WEIGHT = MATL_ID_WEIGHT,",
                "          BOL_WEIGHT_UOM = UOM_WEIGHT,",
                "          ITEM_WEIGHT_UOM = UOM_WEIGHT,",
                "          VEHICLE_ID = regexExtract(VEHICLE_ID,'(\\\\d+)',1),",
                "          EQUIPMENT_TYPE = toString(null()),",
                "          SHIP_SOURCE_LAST_UPDATE_TS = toString(currentUTC()),",
                "          SHIPMENT_STATUS = \"SHIPPED\",",
                "          SHIP_FROM_LEGACY_CODE = ORIG_CUST_CODE,",
                "          SHIP_TO_LEGACY_CODE = DEST_CUST_CODE,",
                "          ITEM_COUNT = /*ITEM_SHIPPED_PIECES*/\r",
                "\"1\",",
                "          {QUANTITY_PIECES } = ITEM_SHIPPED_PIECES,",
                "          STCC_CODE = iif(isNull(STCC_CODE_OUT)||trim(STCC_CODE_OUT)=='',toString(null()),STCC_CODE_OUT),",
                "          SAP_ORDER_NUMBER = ltrim(SAP_ORDER_NUM,'0'),",
                "          LEGACY_ORDER_NUMBER = MS_ORDER_MILL_SPLIT_NO2,",
                "          CUSTOMER_PART = PART_NUMBER,",
                "          FINISH_CODE = toString(null()),",
                "          LOAD_NUMBER = PACK_BOL_NUM,",
                "          SOURCE_SYSTEM = iif(FACILITY_CODE==\"54\",\"BHLFR\",iif(FACILITY_CODE==\"55\",\"BH-PLATES\",iif(FACILITY_CODE==\"58\" || FACILITY_CODE ==\"59\",\"EASTERN PLATES\",toString(null())))),",
                "          BOL_NUMBER = substring(PACK_BOL_NUM, 1, 10),",
                "          HEAT_NUMBER = OUT_HEAT_NBR,",
                "          PROCESSOR_BOL = toString(null()),",
                "          ACCT_PROD = substring(ACCT_PROD_CODE, length(ACCT_PROD_CODE) - 2, 3),",
                "          FINISHING_PLANT = toString(null()),",
                "          Commodity_lfr := iif(FACILITY_CODE==\"54\" && substring(PACK_BOL_NUM,1,4)==\"0808\" ,\"SLAB\",\"COIL\"),",
                "          Commodity_plates := iif(FACILITY_CODE==\"55\" && (substring(PACK_BOL_NUM,1,4)==\"0802\" || substring(PACK_BOL_NUM,1,4)==\"0803\" || substring(PACK_BOL_NUM,1,4)==\"0804\" ) ,\"PLATE\",\"\"),",
                "          Commodity_Ep := iif((FACILITY_CODE==\"58\" || FACILITY_CODE ==\"59\") && (STCC_CODE_OUT==\"3312210\"|| STCC_CODE_OUT==\"3312253\" || STCC_CODE_OUT == \"3356358\" ),\"PLATE\",\r",
                "iif((FACILITY_CODE==\"58\" || FACILITY_CODE==\"59\")  && STCC_CODE_OUT == \"3312140\",'SLAB','')),",
                "          Ship_to_lfr := iif(isNull(SnkLegacyMasterCache#lookup(DEST_CUST_CODE,'EDS LEGACY').SAP_KUNNR),SnkLegacyPlantXref#lookup(right(DEST_CUST_CODE,2),'BETH').SAP_PLANT_ID,SnkLegacyMasterCache#lookup(DEST_CUST_CODE,'EDS LEGACY').SAP_KUNNR),",
                "          Ship_to_plates_EP := iif((FACILITY_CODE=='55'),SnkLegacyMasterCache#lookup(DEST_CUST_CODE,'EDS LEGACY').SAP_KUNNR,\r",
                "iif((FACILITY_CODE==\"58\" || FACILITY_CODE ==\"59\"),SnkLegacyMasterCache#lookup(trim(DEST_CUST_CODE),'EDS LEGACY').SAP_KUNNR,''))) ~> LookupsAndDateConversion",
                "LookupsAndDateConversion derive(SAP_KUNNR = SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_KUNNR,",
                "          PLANT_ID = SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_PLANT_ID,",
                "          RAIL_ROUTE_FULL_DESC = iif(trim(TRANSPORTATION_MODE_CODE)=='RAIL',SnkOdsRefMasterXrefCache#lookup(\"BETH\",\"ROUTE-DESCR\",\"ODS\",\"RAIL_ROUTE_FULL_DESC\",upper(trim(ROUTE_DESCR))).DESTINATION_CODE_VALUE,iif(trim(TRANSPORTATION_MODE_CODE)=='TRUCK',SnkTruckRouteDesc#lookup(SCAC_Code).carrier_name,toString(null()))),",
                "          SHIP_FROM_TYPE = iif(isNull(SHIP_FROM_LOCATION_ID) && !(isNull(ORIG_CUST_CODE)),'OP',\r",
                "iif(!(isNull(SHIP_FROM_LOCATION_ID)) && length(SHIP_FROM_LOCATION_ID)<=4,'PLANT',\r",
                "iif(!(isNull(SHIP_FROM_LOCATION_ID)) && length(SHIP_FROM_LOCATION_ID)>4,'OP',toString(null())))),",
                "          SHIP_TO_TYPE = iif(MS_INTERPLANT == '0' || MS_INTERPLANT == '1' || MS_INTERPLANT == '4' || MS_INTERPLANT == '7', 'CUSTOMER',\r",
                "iif(MS_INTERPLANT == '2' || MS_INTERPLANT == '3', 'OP',\r",
                "iif(MS_INTERPLANT == '5' || MS_INTERPLANT == '6', 'PLANT',\r",
                "toString(null())\r",
                ")))) ~> PlantAndKunnrLookup",
                "FtrBhLfr derive(each(match(name!=\"\"), $$ = upper(trim(toString($$))))) ~> OdsStandardConversion",
                "SplitOnErrors@ProperRows, SelectErrorFields exists(/* SplitOnErrors@ProperRows@BOL_NUMBER == SelectErrorFields@BOL_NUMBER && SplitOnErrors@ProperRows@SHIPMENT_DATE == SelectErrorFields@SHIPMENT_DATE */\r",
                "SplitOnErrors@ProperRows@SOURCE_LOAD_NUMBER == SelectErrorFields@SOURCE_LOAD_NUMBER && SplitOnErrors@ProperRows@SHIPMENT_DATE == SelectErrorFields@SHIPMENT_DATE,",
                "     negate:false,",
                "     broadcast: 'auto')~> exists1",
                "exists1 derive(ERROR_FLAG = \"Y\",",
                "          ERROR_FIELDS = \"\",",
                "          ERROR_MESSAGE_CALC = \"FAILED DUE TO OTHER ITEMS IN THE SAME SHIPMENT\") ~> existsmappingconversion",
                "existsmappingconversion select(mapColumn(",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          LOAD_NUMBER,",
                "          TRANSPORTATION_MODE_CODE,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_LOCATION_NAME1,",
                "          SHIP_FROM_LOCATION_NAME2,",
                "          SHIP_FROM_LOCATION_ADDRESS,",
                "          SHIP_FROM_LOCATION_CITY,",
                "          SHIP_FROM_LOCATION_STATE,",
                "          SHIP_FROM_LOCATION_COUNTRY,",
                "          SHIP_FROM_LOCATION_ZIPCODE,",
                "          SHIP_TO_LOCATION_ID,",
                "          SHIP_TO_LOCATION_NAME1,",
                "          SHIP_TO_LOCATION_NAME2,",
                "          SHIP_TO_LOCATION_ADDRESS,",
                "          SHIP_TO_LOCATION_CITY,",
                "          SHIP_TO_LOCATION_STATE,",
                "          SHIP_TO_LOCATION_COUNTRY,",
                "          SHIP_TO_LOCATION_ZIPCODE,",
                "          CONTROL_LOCATION_ID = SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SHIP_TO_STATION_CITY,",
                "          SHIP_TO_STATION_STATE,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          PAYMENT_TYPE,",
                "          CARRIER_CODE,",
                "          VEHICLE_PREFIX,",
                "          VEHICLE_ID,",
                "          BOL_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          RAIL_ROUTE_CODE,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SCAC_CODE,",
                "          MATERIAL_ID = MATERAIL_ID,",
                "          ENG_GAUGE = DIM_GAUGE_ENG,",
                "          MET_GAUGE = {DIM_GAUGE_MET },",
                "          ENG_WIDTH = DIM_WIDTH_ENG,",
                "          MET_WIDTH = DIM_WIDTH_MET,",
                "          ENG_LENGTH = DIM_LENGTH_ENG,",
                "          MET_LENGTH = DIM_LENGTH_MET,",
                "          ITEM_WEIGHT,",
                "          ITEM_WEIGHT_UOM,",
                "          OVER_DIMENSIONAL,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          COMMODITY,",
                "          SUB_COMMODITY,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          HEAT_NUMBER,",
                "          CUSTOMER_PART_NO = CUSTOMER_PART,",
                "          SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          ERROR_FLAG,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGES_CALC = ERROR_MESSAGE_CALC,",
                "          CREATED_DATE,",
                "          LAST_UPDATED_DATE,",
                "          FINISH_CODE,",
                "          FREIGHT_SOURCE_SYSTEM = {Freight Source Type},",
                "          CHARGE_TYPE,",
                "          PTMX_LOAD_NUMBER,",
                "          LOAD_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          MINIMUM_RATE,",
                "          DISTANCE_MILAGE,",
                "          RATE_AUTHORITY,",
                "          CHARGE_TYPE_DESC,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          CHARGE_RATE,",
                "          CHARGE_RATE_UOM,",
                "          CURRENCY,",
                "          CHARGE_AMOUNT,",
                "          PRODUCT_CODE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          AP_SHIP_TO_TYPE,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          PROCESSOR_PIECE_ID,",
                "          SKID,",
                "          THEO_WEIGHT_LB,",
                "          THEO_WEIGHT_KG,",
                "          SHIPMENT_HEADER_COMMENTS,",
                "          MISC_COMMENTS_ITEM,",
                "          LINEAL_FEET_MT,",
                "          LINEAL_FEET_ENG,",
                "          IS_PRIME_LFR,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SOURCE_BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          CARRIER_NAME,",
                "          TRIP_TITLE,",
                "          {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          ITEM_FREIGHT_WEIGHT,",
                "          BOL_FREIGHT_WEIGHT,",
                "          INTERNAL_SHIPMENT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> SelectExists",
                "SelectErrorFields, SelectExists union(byName: true)~> union1",
                "FreightErrorFieldsAggregation select(mapColumn(",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          LOAD_NUMBER,",
                "          TRANSPORTATION_MODE_CODE,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_LOCATION_NAME1,",
                "          SHIP_FROM_LOCATION_NAME2,",
                "          SHIP_FROM_LOCATION_ADDRESS,",
                "          SHIP_FROM_LOCATION_CITY,",
                "          SHIP_FROM_LOCATION_STATE,",
                "          SHIP_FROM_LOCATION_COUNTRY,",
                "          SHIP_FROM_LOCATION_ZIPCODE,",
                "          SHIP_TO_LOCATION_ID,",
                "          SHIP_TO_LOCATION_NAME1,",
                "          SHIP_TO_LOCATION_NAME2,",
                "          SHIP_TO_LOCATION_ADDRESS,",
                "          SHIP_TO_LOCATION_CITY,",
                "          SHIP_TO_LOCATION_STATE,",
                "          SHIP_TO_LOCATION_COUNTRY,",
                "          SHIP_TO_LOCATION_ZIPCODE,",
                "          CONTROL_LOCATION_ID = SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SHIP_TO_STATION_CITY,",
                "          SHIP_TO_STATION_STATE,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          PROCESSOR_BOL,",
                "          PAYMENT_TYPE,",
                "          CARRIER_CODE,",
                "          VEHICLE_PREFIX,",
                "          VEHICLE_ID,",
                "          BOL_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          RAIL_ROUTE_CODE,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SCAC_CODE,",
                "          MATERIAL_ID = MATERAIL_ID,",
                "          ENG_GAUGE = DIM_GAUGE_ENG,",
                "          MET_GAUGE = {DIM_GAUGE_MET },",
                "          ENG_WIDTH = DIM_WIDTH_ENG,",
                "          MET_WIDTH = DIM_WIDTH_MET,",
                "          ENG_LENGTH = DIM_LENGTH_ENG,",
                "          MET_LENGTH = DIM_LENGTH_MET,",
                "          ITEM_WEIGHT,",
                "          ITEM_WEIGHT_UOM,",
                "          OVER_DIMENSIONAL,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          COMMODITY,",
                "          SUB_COMMODITY,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          HEAT_NUMBER,",
                "          CUSTOMER_PART_NO = CUSTOMER_PART,",
                "          SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          ERROR_FLAG,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGES_CALC = ERROR_MESSAGE,",
                "          CREATED_DATE,",
                "          LAST_UPDATED_DATE,",
                "          FINISH_CODE,",
                "          FREIGHT_SOURCE_SYSTEM = {Freight Source Type},",
                "          CHARGE_TYPE,",
                "          PTMX_LOAD_NUMBER,",
                "          LOAD_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          MINIMUM_RATE,",
                "          DISTANCE_MILAGE,",
                "          RATE_AUTHORITY,",
                "          CHARGE_TYPE_DESC,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          CHARGE_RATE,",
                "          CHARGE_RATE_UOM,",
                "          CURRENCY,",
                "          CHARGE_AMOUNT,",
                "          PRODUCT_CODE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          AP_SHIP_TO_TYPE,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          PROCESSOR_PIECE_ID,",
                "          SKID,",
                "          THEO_WEIGHT_LB,",
                "          THEO_WEIGHT_KG,",
                "          SHIPMENT_HEADER_COMMENTS,",
                "          MISC_COMMENTS_ITEM,",
                "          LINEAL_FEET_MT,",
                "          LINEAL_FEET_ENG,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          IS_PRIME_LFR,",
                "          SOURCE_BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          CARRIER_NAME,",
                "          TRIP_TITLE,",
                "          {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          ITEM_FREIGHT_WEIGHT,",
                "          BOL_FREIGHT_WEIGHT,",
                "          INTERNAL_SHIPMENT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> FreightErrorSelect",
                "union4, ValidSelect union(byName: true)~> union2",
                "SplitOnErrors@ProperRows, SelectErrorFields exists(/* SplitOnErrors@ProperRows@BOL_NUMBER == SelectErrorFields@BOL_NUMBER && SplitOnErrors@ProperRows@SHIPMENT_DATE == SelectErrorFields@SHIPMENT_DATE */\r",
                "SplitOnErrors@ProperRows@SOURCE_LOAD_NUMBER == SelectErrorFields@SOURCE_LOAD_NUMBER && SplitOnErrors@ProperRows@SHIPMENT_DATE == SelectErrorFields@SHIPMENT_DATE,",
                "     negate:true,",
                "     broadcast: 'auto')~> ValidShipmentRecord1",
                "derivedColumn6 select(mapColumn(",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          LOAD_NUMBER,",
                "          TRANSPORTATION_MODE_CODE,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_LOCATION_NAME1,",
                "          SHIP_FROM_LOCATION_NAME2,",
                "          SHIP_FROM_LOCATION_ADDRESS,",
                "          SHIP_FROM_LOCATION_CITY,",
                "          SHIP_FROM_LOCATION_STATE,",
                "          SHIP_FROM_LOCATION_COUNTRY,",
                "          SHIP_FROM_LOCATION_ZIP = SHIP_FROM_LOCATION_ZIPCODE,",
                "          SHIP_TO_LOCATION_ID,",
                "          SHIP_TO_LOCATION_NAME1,",
                "          SHIP_TO_LOCATION_NAME2,",
                "          SHIP_TO_LOCATION_ADDRESS,",
                "          SHIP_TO_LOCATION_CITY,",
                "          SHIP_TO_LOCATION_STATE,",
                "          SHIP_TO_LOCATION_COUNTRY,",
                "          SHIP_TO_LOCATION_ZIP = SHIP_TO_LOCATION_ZIPCODE,",
                "          CONTROL_LOCATION_ID = SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          PAYMENT_TYPE,",
                "          CARRIER_CODE,",
                "          VEHICLE_PREFIX,",
                "          VEHICLE_ID,",
                "          BOL_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          RAIL_ROUTE_CODE,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SHIP_TO_STATION_CITY,",
                "          SHIP_TO_STATION_STATE,",
                "          SCAC_CODE,",
                "          ITEM_NUMBER,",
                "          INTERNAL_SHIPMENT,",
                "          MATERIAL_ID,",
                "          DIM_GAUGE_ENG = ENG_GAUGE,",
                "          DIM_GAUGE_MET = MET_GAUGE,",
                "          DIM_WIDTH_ENG = ENG_WIDTH,",
                "          DIM_WIDTH_MET = MET_WIDTH,",
                "          DIM_LENGTH_ENG = ENG_LENGTH,",
                "          DIM_LENGTH_MET = MET_LENGTH,",
                "          ITEM_WEIGHT,",
                "          ITEM_WEIGHT_UOM,",
                "          OVER_DIMENSIONAL,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          COMMODITY,",
                "          SUB_COMMODITY,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          HEAT_NUMBER,",
                "          CUSTOMER_PART = CUSTOMER_PART_NO,",
                "          FINISH_CODE,",
                "          SHIP_SOURCE_LAST_UPDATED_DATE = SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          ERROR_FLAG,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGE,",
                "          CREATED_DATE,",
                "          LAST_MODIFIED_DATE = LAST_UPDATED_DATE,",
                "          CHARGE_TYPE,",
                "          PTMX_LOAD_NUMBER,",
                "          LOAD_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          MINIMUM_RATE,",
                "          DISTANCE_MILAGE,",
                "          RATE_AUTHORITY,",
                "          CHARGE_TYPE_DESC,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          CHARGE_RATE,",
                "          CHARGE_RATE_UOM,",
                "          CURRENCY,",
                "          CHARGE_AMOUNT,",
                "          PRODUCT_CODE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          AP_SHIP_TO_TYPE,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          MILL_ORDER_NUMBER,",
                "          DIVISION_CODE,",
                "          PROCESSOR_PIECE_ID,",
                "          SKID,",
                "          THEO_WEIGHT_LB,",
                "          THEO_WEIGHT_KG,",
                "          SHIPMENT_HEADER_COMMENTS,",
                "          MISC_COMMENTS_ITEM,",
                "          LINEAL_FEET_MT,",
                "          LINEAL_FEET_ENG,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          IS_PRIME_LFR,",
                "          SOURCE_BOL_NUMBER,",
                "          CARRIER_NAME,",
                "          TRIP_TITLE,",
                "          QUANTITY_PIECES = {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          ITEM_FREIGHT_WEIGHT,",
                "          BOL_FREIGHT_WEIGHT,",
                "          TIMEZONE,",
                "          LEGACY_CUSTOMER_CODE",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> select1",
                "ChargeTypeBasedColumns derive(SHIP_FROM_LOCATION_NAME1 = iifNull(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_PLANT_NAME1,SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_NAME1),",
                "          SHIP_FROM_LOCATION_NAME2 = iifNull(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_PLANT_NAME2,SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_NAME2 ,\"\" ),",
                "          SHIP_FROM_LOCATION_ADDRESS = iifNull(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_STREET,concat(iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_HOUSE_NUM1,\"\"),\" \",iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_STREET,\"\")),\"\"),",
                "          SHIP_FROM_LOCATION_CITY = iifNull(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_CITY,SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_CITY1,\"\"),",
                "          SHIP_FROM_LOCATION_STATE = iifNull(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_STATE,SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_REGION,\"\"),",
                "          SHIP_FROM_LOCATION_COUNTRY = iifNull(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_COUNTRY,SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_COUNTRY,\"\"),",
                "          SHIP_FROM_LOCATION_ZIPCODE = iifNull(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_POST_CODE,SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_POST_CODE1,\"\"),",
                "          SHIP_TO_LOCATION_NAME1 = iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_NAME1,SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_PLANT_NAME1,\"\"),",
                "          SHIP_TO_LOCATION_NAME2 = iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_NAME2,SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_PLANT_NAME2,\"\"),",
                "          SHIP_TO_LOCATION_ADDRESS = iifNull(concat(iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_HOUSE_NUM1,\"\"),\" \",\r",
                "iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_STREET,\"\")),\r",
                "SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_STREET,\"\"),",
                "          SHIP_TO_LOCATION_CITY = iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_CITY1,SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_CITY,\"\"),",
                "          SHIP_TO_LOCATION_STATE = iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_REGION,SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_STATE,\"\"),",
                "          SHIP_TO_LOCATION_COUNTRY = iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_COUNTRY,SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_COUNTRY,\"\"),",
                "          SHIP_TO_LOCATION_ZIPCODE = iifNull(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_POST_CODE1,SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_POST_CODE,\"\"),",
                "          SHIP_TO_STATION_CITY = toString(null()),",
                "          SHIP_TO_STATION_STATE = toString(null()),",
                "          SHIP_FROM_STATION_CITY = toString(null()),",
                "          SHIP_FROM_STATION_STATE = toString(null()),",
                "          CHARGE_AMOUNT = iif(CHARGE_TYPE == \"SC\", ITEM_SC_AMOUNT, iif(CHARGE_TYPE == \"LH\", ITEM_LH_AMOUNT, iif(CHARGE_TYPE == \"ZZ\", MATL_ID_PRO_AMT, toString(null()))))) ~> BHLFRShippingColumns",
                "SrcLkpSapMaterialGroupMasterXref filter(upper(trim(SOURCE_SYSTEM_Name)) == \"BH-LFR\" || upper(trim(SOURCE_SYSTEM_Name)) == \"BH-PLATES\"  || upper(trim(SOURCE_SYSTEM_Name)) == \"EASTERN PLATES\") ~> FtrBethRec",
                "FtrBethRec derive(each(match(name!=\"\"), $$ = upper(trim(toString($$))))) ~> OdsStandardConv",
                "FtrEdsLegacy derive(LEGACY_SYSTEM = upper(LEGACY_SYSTEM)) ~> ConvertUpper",
                "select1 filter(instr(upper(ERROR_MESSAGE),'INVALID')>0 && instr(upper(ERROR_MESSAGE),'NULL')==0 && instr(upper(ERROR_MESSAGE),'EMPTY')==0) ~> FtrInvalisRec",
                "FtrInvalisRec aggregate(groupBy(SOURCE_LOAD_NUMBER,",
                "          SHIPMENT_DATE),",
                "     ERR = count(BOL_NUMBER)) ~> AgrBol",
                "AgrBol, SrcBronzeBh join(SOURCE_LOAD_NUMBER == trim(PACK_BOL_NUM)",
                "     && AgrBol@SHIPMENT_DATE == concat(SHIPPED_MONTH,'/',SHIPPED_DAY,'/',SHIPPED_CC_SHIPPED_YEAR),",
                "     joinType:'inner',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> Joinwithsrc",
                "Joinwithsrc select(mapColumn(",
                "          ACD,",
                "          INVOICE_NUM,",
                "          MATERIAL_ID,",
                "          INVOICE_CC_INVOICE_YEAR,",
                "          INVOICE_MONTH,",
                "          INVOICE_DAY,",
                "          PACK_BOL_NUM,",
                "          PACK_SLIP_NUM,",
                "          SHIPPED_CC_SHIPPED_YEAR,",
                "          SHIPPED_MONTH,",
                "          SHIPPED_DAY,",
                "          SHIP_MO,",
                "          SHIP_DAY,",
                "          SHIP_YEAR,",
                "          SHIPPED_TIME,",
                "          MS_INTERPLANT,",
                "          METH_OF_SHIP,",
                "          SCAC_CODE,",
                "          SCAC_DESCR,",
                "          ROUTE_CODE,",
                "          ROUTE_DESCR,",
                "          VEHICLE_ID,",
                "          P_C_IND,",
                "          PREPAID_COLLECT,",
                "          MILEAGE,",
                "          DISTANCE_UOM,",
                "          TOTAL_SHIP_WEIGHT,",
                "          UOM_WEIGHT,",
                "          MIN_WEIGHT,",
                "          MIN_WEIGHT_UOM,",
                "          TOTAL_FRT_COST,",
                "          FRT_RATE,",
                "          FRT_UOM,",
                "          ADDTNL_FRT_COST,",
                "          ADDTNL_FRT_RATE,",
                "          ADDTNL_FRT_UOM,",
                "          FRT_COST_SC,",
                "          FRT_SC_RATE,",
                "          FRT_SC_UOM,",
                "          CUST_CODE,",
                "          BILL_TO_CUSTOMER,",
                "          ORIG_CUST_CODE,",
                "          SHIP_FROM_DESCR,",
                "          SHIP_FROM_STATE,",
                "          SHIP_FROM_CITY,",
                "          SHIP_FROM_ZIP_CODE,",
                "          SHIP_FROM_COUNTRY,",
                "          DEST_CUST_CODE,",
                "          SHIP_TO_CUSTOMER,",
                "          SHIP_TO_STATE,",
                "          SHIP_TO_CITY,",
                "          SHIP_TO_ZIP_CODE,",
                "          SHIP_TO_COUNTRY,",
                "          DATA_SOURCE,",
                "          COMPETITIVE_IND,",
                "          CONTRACT_RATE,",
                "          MILL_ORDER_SPLIT_NO1,",
                "          MS_ORDER_MILL_SPLIT_NO2,",
                "          FACILITY_CODE,",
                "          STCC_CODE_OUT,",
                "          THICKNESS_MAX,",
                "          THICKNESS_UOM,",
                "          WIDTH_MAX,",
                "          WIDTH_UOM,",
                "          LENGTH_MAX,",
                "          LENGTH_UOM,",
                "          PART_NUMBER,",
                "          PART_NUMBER_DESC,",
                "          COMMODITY_DESCR,",
                "          ITEM_FRT_COST,",
                "          MATL_ID_WEIGHT,",
                "          MATL_ID_LAST_COIL,",
                "          MATL_ID_PRO_AMT,",
                "          MATL_ID_SC_AMT,",
                "          CUST_FRT,",
                "          POSTING_PERIOD,",
                "          ITEM_SHIPPED_PIECES,",
                "          PROCESSOR_MATL_ID,",
                "          OUT_TM_AVAIL_TO_SHIP_DATE,",
                "          OUT_TM_LOAD_READY_DATE,",
                "          OUT_TM_DATE_SCHD_PICKUP,",
                "          OUT_TM_PLN_CARRIER_PICKUP_DTE,",
                "          OUT_PLANNED_TRANS_MODE,",
                "          OUT_PLANNED_FRT_TYPE_CODE,",
                "          OUT_PLANNED_NEXT_SHIP_DATE,",
                "          OUT_HEAT_NBR,",
                "          ACCT_PROD_CODE,",
                "          FRT_COST_SC,",
                "          ADDTNL_FRT_COST,",
                "          MATL_ID_WEIGHT,",
                "          MIN_WEIGHT,",
                "          DISTANCE_UOM,",
                "          BETH_SOURCE_CODE,",
                "          LINEAL_FT_ENG,",
                "          LINEAL_FT_MET,",
                "          THEO_WGT_LB,",
                "          THEO_WGT_KG,",
                "          TIME_ZONE,",
                "          SAP_ORDER_NUM,",
                "          STATUS,",
                "          ACTION,",
                "          BOL_NUMBER,",
                "          SHIPMENT_DATE = SrcBronzeBh@SHIPMENT_DATE,",
                "          SOURCE_SYSTEM,",
                "          {_c95},",
                "          CUST_FRT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> SelectSrcColns",
                "SelectSrcColns, select1 join(trim(PACK_BOL_NUM) == SOURCE_LOAD_NUMBER",
                "     && SelectSrcColns@MATERIAL_ID == select1@MATERIAL_ID",
                "     && coalesce(MS_ORDER_MILL_SPLIT_NO2,'') == LEGACY_ORDER_NUMBER,",
                "     joinType:'inner',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> JoinErr",
                "JoinErr select(mapColumn(",
                "          ACD,",
                "          INVOICE_NUM,",
                "          MATERIAL_ID = SelectSrcColns@MATERIAL_ID,",
                "          INVOICE_CC_INVOICE_YEAR,",
                "          INVOICE_MONTH,",
                "          INVOICE_DAY,",
                "          PACK_BOL_NUM,",
                "          PACK_SLIP_NUM,",
                "          SHIPPED_CC_SHIPPED_YEAR,",
                "          SHIPPED_MONTH,",
                "          SHIPPED_DAY,",
                "          SHIP_MO,",
                "          SHIP_DAY,",
                "          SHIP_YEAR,",
                "          SHIPPED_TIME,",
                "          MS_INTERPLANT,",
                "          METH_OF_SHIP,",
                "          SCAC_CODE = SelectSrcColns@SCAC_CODE,",
                "          SCAC_DESCR,",
                "          ROUTE_CODE,",
                "          ROUTE_DESCR,",
                "          VEHICLE_ID = SelectSrcColns@VEHICLE_ID,",
                "          P_C_IND,",
                "          PREPAID_COLLECT,",
                "          MILEAGE,",
                "          DISTANCE_UOM,",
                "          TOTAL_SHIP_WEIGHT,",
                "          UOM_WEIGHT,",
                "          MIN_WEIGHT,",
                "          MIN_WEIGHT_UOM,",
                "          TOTAL_FRT_COST,",
                "          FRT_RATE,",
                "          FRT_UOM,",
                "          ADDTNL_FRT_COST,",
                "          ADDTNL_FRT_RATE,",
                "          ADDTNL_FRT_UOM,",
                "          FRT_COST_SC,",
                "          FRT_SC_RATE,",
                "          FRT_SC_UOM,",
                "          CUST_CODE,",
                "          BILL_TO_CUSTOMER,",
                "          ORIG_CUST_CODE,",
                "          SHIP_FROM_DESCR,",
                "          SHIP_FROM_STATE,",
                "          SHIP_FROM_CITY,",
                "          SHIP_FROM_ZIP_CODE,",
                "          SHIP_FROM_COUNTRY,",
                "          DEST_CUST_CODE,",
                "          SHIP_TO_CUSTOMER,",
                "          SHIP_TO_STATE,",
                "          SHIP_TO_CITY,",
                "          SHIP_TO_ZIP_CODE,",
                "          SHIP_TO_COUNTRY,",
                "          DATA_SOURCE,",
                "          COMPETITIVE_IND,",
                "          CONTRACT_RATE,",
                "          MILL_ORDER_SPLIT_NO1,",
                "          MS_ORDER_MILL_SPLIT_NO2,",
                "          FACILITY_CODE,",
                "          STCC_CODE_OUT,",
                "          THICKNESS_MAX,",
                "          THICKNESS_UOM,",
                "          WIDTH_MAX,",
                "          WIDTH_UOM,",
                "          LENGTH_MAX,",
                "          LENGTH_UOM,",
                "          PART_NUMBER,",
                "          PART_NUMBER_DESC,",
                "          COMMODITY_DESCR,",
                "          ITEM_FRT_COST,",
                "          MATL_ID_WEIGHT,",
                "          MATL_ID_LAST_COIL,",
                "          MATL_ID_PRO_AMT,",
                "          MATL_ID_SC_AMT,",
                "          CUST_FRT,",
                "          POSTING_PERIOD,",
                "          ITEM_SHIPPED_PIECES,",
                "          PROCESSOR_MATL_ID,",
                "          OUT_TM_AVAIL_TO_SHIP_DATE,",
                "          OUT_TM_LOAD_READY_DATE,",
                "          OUT_TM_DATE_SCHD_PICKUP,",
                "          OUT_TM_PLN_CARRIER_PICKUP_DTE,",
                "          OUT_PLANNED_TRANS_MODE,",
                "          OUT_PLANNED_FRT_TYPE_CODE,",
                "          OUT_PLANNED_NEXT_SHIP_DATE,",
                "          OUT_HEAT_NBR,",
                "          ACCT_PROD_CODE,",
                "          FRT_COST_SC,",
                "          ADDTNL_FRT_COST,",
                "          MATL_ID_WEIGHT,",
                "          MIN_WEIGHT,",
                "          DISTANCE_UOM,",
                "          BETH_SOURCE_CODE,",
                "          LINEAL_FT_ENG,",
                "          LINEAL_FT_MET = LINEAL_FEET_MT,",
                "          THEO_WGT_LB,",
                "          THEO_WGT_KG,",
                "          TIME_ZONE,",
                "          SAP_ORDER_NUM,",
                "          STATUS,",
                "          ACTION,",
                "          BOL_NUMBER = SelectSrcColns@BOL_NUMBER,",
                "          SHIPMENT_DATE = SelectSrcColns@SHIPMENT_DATE,",
                "          SOURCE_SYSTEM = SelectSrcColns@SOURCE_SYSTEM,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGE,",
                "          {_c95},",
                "          CUST_FRT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> SelectErr",
                "SrcBronzeErr, SrcBronzeBh exists(SrcBronzeErr@PACK_BOL_NUM == SrcBronzeBh@PACK_BOL_NUM",
                "     && concat(SrcBronzeErr@SHIPPED_MONTH,'/',SrcBronzeErr@SHIPPED_DAY,'/',SrcBronzeBh@SHIPPED_CC_SHIPPED_YEAR) == concat(SrcBronzeBh@SHIPPED_MONTH,'/',SrcBronzeBh@SHIPPED_DAY,'/',SrcBronzeBh@SHIPPED_CC_SHIPPED_YEAR),",
                "     negate:true,",
                "     broadcast: 'auto')~> exists2",
                "SrcBronzeBh, exists2 union(byName: true)~> UnionSrcErr",
                "derivedColumn9 derive(each(match(name!=\"\"), $$ = trim(toString($$)))) ~> derivedColumn1",
                "union2 derive(ERROR_MESSAGE = iif(((instr(upper(ERROR_MESSAGES_CALC), 'INVALID') > 0 ) && (instr(upper(ERROR_MESSAGES_CALC), 'NULL') == 0 && instr(upper(ERROR_MESSAGES_CALC), 'EMPTY') == 0)),\r",
                "    concat('LOOKUP ERROR: ', ERROR_MESSAGES_CALC),\r",
                "    iif(instr(upper(ERROR_MESSAGES_CALC), 'NULL') > 0,\r",
                "        concat('SOURCE ERROR: ', ERROR_MESSAGES_CALC),\r",
                "        iif(instr(upper(ERROR_MESSAGES_CALC), 'EMPTY') > 0,\r",
                "            concat('SOURCE ERROR: ', ERROR_MESSAGES_CALC),\r",
                "            iif(instr(upper(ERROR_MESSAGES_CALC), 'INVALID') > 0 \r",
                "                    && (instr(upper(ERROR_MESSAGES_CALC), 'NULL') > 0 || instr(upper(ERROR_MESSAGES_CALC), 'EMPTY') > 0),\r",
                "                concat('SOURCE ERROR: ', ERROR_MESSAGES_CALC),\r",
                "                ERROR_MESSAGES_CALC\r",
                "            )\r",
                "        )\r",
                "    )\r",
                ")) ~> derivedColumn2",
                "derivedColumn2 derive(ITEM_NUMBER = toString(null()),",
                "          each(match(name!='ITEM_NUMBER'), $$ = iif(length(trim($$))>0, trim($$), toString(null())))) ~> InternalShipmentCalc",
                "RailRouteFullDesc window(over(LOAD_NUMBER),",
                "     LOAD_WEIGHT = toString(toInteger(sum(MATL_ID_WEIGHT_NUMERIC)))) ~> windowLoadWeight",
                "MinWeightCalc derive(CHARGE_TYPE_DESC = iif(CHARGE_TYPE == \"SC\", \"FUEL SURCHARGE\", iif(CHARGE_TYPE == \"LH\", \"LINE HAUL\", \"MISCELLANEOUS\")),",
                "          CHARGE_RATE = iif(CHARGE_TYPE == \"SC\", FRT_SC_RATE, iif(CHARGE_TYPE == \"LH\", FRT_RATE, iif(CHARGE_TYPE == \"ZZ\", ADDTNL_FRT_RATE, toString(null())))),",
                "          CHARGE_RATE_UOM = iif(CHARGE_TYPE == \"SC\", FRT_SC_UOM, iif(CHARGE_TYPE == \"LH\", FRT_UOM, iif(CHARGE_TYPE == \"ZZ\", ADDTNL_FRT_UOM, toString(null())))),",
                "          ITEM_SC_AMOUNT = toString(round(toDecimal(MATL_ID_SC_AMT),2))) ~> ChargeTypeBasedColumns",
                "InternalShipmentCalc derive(MILL_ORDER_NUMBER = toString(null()),",
                "          DIVISION_CODE = toString(null()),",
                "          LEGACY_CUSTOMER_CODE = toString(null())) ~> derivedColumn6",
                "selectToRemoveNumericFields derive(isLH = 'LH',",
                "          isSC = iif((FRT_COST_SC != '0.0000' && FRT_COST_SC != '0' && !isNull(FRT_COST_SC)), \"SC\", toString(null())),",
                "          isZZ = iif((ADDTNL_FRT_COST != '0.0000' && ADDTNL_FRT_COST != '0' && !isNull(ADDTNL_FRT_COST)), \"ZZ\", toString(null())),",
                "          FORMATTED_SOURCE_LOAD_NUMBER = left(SOURCE_LOAD_NUMBER,10)) ~> derivedColumn7",
                "derivedColumn7 unpivot(output(",
                "          CHARGE_TYPE_TYPE as string,",
                "          CHARGE_TYPE as string",
                "     ),",
                "     ungroupBy(PACK_BOL_NUM,",
                "          FACILITY_CODE,",
                "          SHIPPED_CC_SHIPPED_YEAR,",
                "          SHIPPED_MONTH,",
                "          SHIPPED_DAY,",
                "          SHIPPED_TIME,",
                "          METH_OF_SHIP,",
                "          ORIG_CUST_CODE,",
                "          DEST_CUST_CODE,",
                "          P_C_IND,",
                "          VEHICLE_ID,",
                "          TOTAL_SHIP_WEIGHT,",
                "          ROUTE_CODE,",
                "          ROUTE_DESCR,",
                "          MATERIAL_ID,",
                "          OUT_HEAT_NBR,",
                "          THICKNESS_MAX,",
                "          THICKNESS_UOM,",
                "          WIDTH_MAX,",
                "          WIDTH_UOM,",
                "          LENGTH_UOM,",
                "          LENGTH_MAX,",
                "          MATL_ID_WEIGHT,",
                "          ITEM_SHIPPED_PIECES,",
                "          MS_ORDER_MILL_SPLIT_NO2,",
                "          STCC_CODE_OUT,",
                "          ACCT_PROD_CODE,",
                "          MILL_ORDER_SPLIT_NO1,",
                "          PART_NUMBER,",
                "          FRT_COST_SC,",
                "          ADDTNL_FRT_COST,",
                "          UOM_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          DISTANCE_UOM,",
                "          MILEAGE,",
                "          FRT_SC_RATE,",
                "          FRT_RATE,",
                "          ADDTNL_FRT_RATE,",
                "          FRT_UOM,",
                "          ADDTNL_FRT_UOM,",
                "          MATL_ID_SC_AMT,",
                "          ITEM_FRT_COST,",
                "          MATL_ID_PRO_AMT,",
                "          CUST_CODE,",
                "          PRODUCT_CODE,",
                "          AP_SHIP_TO_TYPE,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_TO_LOCATION_ID,",
                "          COMMODITY,",
                "          DIM_GAUGE_ENG,",
                "          {DIM_GAUGE_MET },",
                "          DIM_WIDTH_ENG,",
                "          DIM_WIDTH_MET,",
                "          DIM_LENGTH_ENG,",
                "          DIM_LENGTH_MET,",
                "          VEHICLE_PREFIX,",
                "          TRANSPORTATION_MODE_CODE,",
                "          PAYMENT_TYPE,",
                "          BOL_WEIGHT,",
                "          ITEM_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          ITEM_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          MATERAIL_ID,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          CUSTOMER_PART,",
                "          FINISH_CODE,",
                "          LOAD_NUMBER,",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          HEAT_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SAP_KUNNR,",
                "          PLANT_ID,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          CARRIER_CODE,",
                "          OVER_DIMENSIONAL,",
                "          CREATED_DATE,",
                "          LAST_UPDATED_DATE,",
                "          RAIL_ROUTE_CODE,",
                "          SUB_COMMODITY,",
                "          {Freight Source Type},",
                "          CURRENCY,",
                "          MINIMUM_RATE,",
                "          RATE_AUTHORITY,",
                "          PTMX_LOAD_NUMBER,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          DISTANCE_MILAGE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          LOAD_WEIGHT,",
                "          FRT_SC_UOM,",
                "          SCAC_CODE,",
                "          BETH_SOURCE_CODE,",
                "          MS_INTERPLANT,",
                "          SOURCE_LOAD_NUMBER,",
                "          SOURCE_BOL_NUMBER,",
                "          CARRIER_NAME,",
                "          LINEAL_FT_ENG,",
                "          LINEAL_FT_MET,",
                "          THEO_WGT_LB,",
                "          THEO_WGT_KG,",
                "          TIME_ZONE,",
                "          PROCESSOR_MATL_ID,",
                "          {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          FORMATTED_SOURCE_LOAD_NUMBER,",
                "          CUST_FRT),",
                "     lateral: false,",
                "     ignoreNullPivots: true) ~> unpivotChargeType",
                "windowLoadWeight select(mapColumn(",
                "          PACK_BOL_NUM,",
                "          FACILITY_CODE,",
                "          SHIPPED_CC_SHIPPED_YEAR,",
                "          SHIPPED_MONTH,",
                "          SHIPPED_DAY,",
                "          SHIPPED_TIME,",
                "          METH_OF_SHIP,",
                "          ORIG_CUST_CODE,",
                "          DEST_CUST_CODE,",
                "          P_C_IND,",
                "          VEHICLE_ID,",
                "          TOTAL_SHIP_WEIGHT,",
                "          ROUTE_CODE,",
                "          ROUTE_DESCR,",
                "          MATERIAL_ID,",
                "          OUT_HEAT_NBR,",
                "          THICKNESS_MAX,",
                "          THICKNESS_UOM,",
                "          WIDTH_MAX,",
                "          WIDTH_UOM,",
                "          LENGTH_UOM,",
                "          LENGTH_MAX,",
                "          MATL_ID_WEIGHT,",
                "          ITEM_SHIPPED_PIECES,",
                "          MS_ORDER_MILL_SPLIT_NO2,",
                "          STCC_CODE_OUT,",
                "          ACCT_PROD_CODE,",
                "          MILL_ORDER_SPLIT_NO1,",
                "          PART_NUMBER,",
                "          FRT_COST_SC,",
                "          ADDTNL_FRT_COST,",
                "          UOM_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          DISTANCE_UOM,",
                "          MILEAGE,",
                "          FRT_SC_RATE,",
                "          FRT_RATE,",
                "          ADDTNL_FRT_RATE,",
                "          FRT_SC_UOM,",
                "          FRT_UOM,",
                "          ADDTNL_FRT_UOM,",
                "          MATL_ID_SC_AMT,",
                "          ITEM_FRT_COST,",
                "          MATL_ID_PRO_AMT,",
                "          CUST_CODE,",
                "          PRODUCT_CODE,",
                "          AP_SHIP_TO_TYPE,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_TO_LOCATION_ID,",
                "          COMMODITY,",
                "          DIM_GAUGE_ENG,",
                "          {DIM_GAUGE_MET },",
                "          DIM_WIDTH_ENG,",
                "          DIM_WIDTH_MET,",
                "          DIM_LENGTH_ENG,",
                "          DIM_LENGTH_MET,",
                "          VEHICLE_PREFIX,",
                "          TRANSPORTATION_MODE_CODE,",
                "          PAYMENT_TYPE,",
                "          BOL_WEIGHT,",
                "          ITEM_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          ITEM_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          MATERAIL_ID,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          CUSTOMER_PART,",
                "          FINISH_CODE,",
                "          LOAD_NUMBER,",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          HEAT_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SAP_KUNNR,",
                "          PLANT_ID,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          CARRIER_CODE,",
                "          SCAC_CODE = DerivedCols@SCAC_CODE,",
                "          OVER_DIMENSIONAL,",
                "          CREATED_DATE,",
                "          LAST_UPDATED_DATE,",
                "          RAIL_ROUTE_CODE,",
                "          SUB_COMMODITY,",
                "          {Freight Source Type},",
                "          CURRENCY,",
                "          MINIMUM_RATE,",
                "          RATE_AUTHORITY,",
                "          PTMX_LOAD_NUMBER,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          DISTANCE_MILAGE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          LOAD_WEIGHT,",
                "          BETH_SOURCE_CODE,",
                "          MS_INTERPLANT,",
                "          SOURCE_BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          CARRIER_NAME,",
                "          LINEAL_FT_ENG,",
                "          LINEAL_FT_MET,",
                "          THEO_WGT_LB,",
                "          THEO_WGT_KG,",
                "          TIME_ZONE,",
                "          PROCESSOR_MATL_ID,",
                "          {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          CUST_FRT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> selectToRemoveNumericFields",
                "ShipFromToStationCityState derive(FRT_SC_RATE_FLAG = iif(CHARGE_TYPE == 'SC','Y','N'),",
                "          FRT_RATE_FLAG = iif(CHARGE_TYPE == 'LH','Y','N'),",
                "          ADDTNL_FRT_RATE_FLAG = iif(CHARGE_TYPE == 'ZZ','Y','N'),",
                "          FRT_SC_UOM_FLAG = iif(CHARGE_TYPE == 'SC','Y','N'),",
                "          FRT_UOM_FLAG = iif(CHARGE_TYPE == 'LH','Y','N'),",
                "          ADDTNL_FRT_UOM_FLAG = iif(CHARGE_TYPE == 'ZZ','Y','N'),",
                "          MATL_ID_SC_AMT_FLAG = iif(CHARGE_TYPE == 'SC','Y','N'),",
                "          ITEM_FRT_COST_FLAG = iif(CHARGE_TYPE == 'LH','Y','N'),",
                "          MATL_ID_PRO_AMT_FLAG = iif(CHARGE_TYPE == 'ZZ','Y','N')) ~> derivedColumn8",
                "derivedColumn12 derive(PRODUCT_CODE = BETH_SOURCE_CODE,",
                "          AP_SHIP_TO_TYPE = iif(MS_INTERPLANT == '0' || MS_INTERPLANT == '1' || MS_INTERPLANT == '4' || MS_INTERPLANT == '7', \r",
                "    'CUSTOMER',\r",
                "    iif(MS_INTERPLANT == '2' || MS_INTERPLANT == '3', \r",
                "        'OP',\r",
                "        iif(MS_INTERPLANT == '5' || MS_INTERPLANT == '6', \r",
                "            'PLANT',\r",
                "            toString(null()))))) ~> derivedColumn9",
                "PlantAndKunnrLookup derive(SHIPMENT_TYPE = concat(concat(SHIP_FROM_TYPE,\" to \"),SHIP_TO_TYPE),",
                "          CARRIER_CODE = iif(TRANSPORTATION_MODE_CODE=='RAIL'||TRANSPORTATION_MODE_CODE=='BARGE',iif(\r",
                "                instr(RAIL_ROUTE_FULL_DESC, '-') > 0,\r",
                "                substring(RAIL_ROUTE_FULL_DESC, 1, instr(RAIL_ROUTE_FULL_DESC, '-') - 1),\r",
                "             SCAC_Code),toString(null())),",
                "          MATERAIL_ID = MATERIAL_ID) ~> derivedColumn10",
                "BHLFRShippingColumns derive(PROCESSOR_PIECE_ID = PROCESSOR_MATL_ID,",
                "          SKID = toString(null()),",
                "          THEO_WEIGHT_LB = THEO_WGT_LB,",
                "          THEO_WEIGHT_KG = THEO_WGT_KG,",
                "          SHIPMENT_HEADER_COMMENTS = toString(null()),",
                "          MISC_COMMENTS_ITEM = toString(null()),",
                "          LINEAL_FEET_MT = LINEAL_FT_MET,",
                "          LINEAL_FEET_ENG = LINEAL_FT_ENG,",
                "          SHIP_FROM_STATION_CITY = toString(null()),",
                "          SHIP_FROM_STATION_STATE = toString(null()),",
                "          IS_PRIME_LFR = SnkSapPrimeLFR#lookup(SUB_COMMODITY).PRODUCTS_TO_SAP_IND,",
                "          TRIP_TITLE = /* toString(iif(in(['SSSS', 'PPPP', 'CCCC', 'CUST'], CARRIER_CODE), 1, 0)) */\r",
                "toString(\r",
                "iif(\r",
                "(in(['SSSS', 'PPPP', 'CCCC', 'CUST'], CARRIER_CODE) || in(['SSSS', 'PPPP', 'CCCC', 'CUST'], SCAC_CODE)|| trim(TRANSPORTATION_MODE_CODE)=='TITLE')\r",
                ", 1, 0)\r",
                "),",
                "          RAIL_ROUTE_FULL_DESC = iif(CARRIER_CODE=='SSSS' || SCAC_CODE=='SSSS', 'TRIP TITLE',\r",
                "iif(CARRIER_CODE=='PPPP' || SCAC_CODE=='PPPP', 'PROCESSOR TRUCK',\r",
                "iif(CARRIER_CODE=='CCCC' || CARRIER_CODE=='CUST' || SCAC_CODE == 'CCCC' || SCAC_CODE == 'CUST', 'CUSTOMER TRUCK',\r",
                "RAIL_ROUTE_FULL_DESC)))) ~> derivedColumn11",
                "derivedColumn11 derive(SHIP_TO_STATION_CITY = iif(\r",
                "TRANSPORTATION_MODE_CODE == \"RAIL\",\r",
                "     case(\r",
                "          SHIP_TO_TYPE == \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, ',')[1]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, \",\")) >= 3\r",
                "               && in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, ',')[1]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, ',')[1]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\")) >= 3 \r",
                "               || size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\")) < 2,\r",
                "               iif(\r",
                "                         in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "                         trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, ',')[1]),\r",
                "                         SHIP_TO_LOCATION_CITY\r",
                "                    )\r",
                "          ),\r",
                "          SHIP_TO_TYPE != \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, ',')[1]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, \",\")) >= 3\r",
                "               && in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, ',')[1]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, ',')[1]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\")) >= 3\r",
                "               || size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\")) < 2,\r",
                "               iif(\r",
                "                    in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "                    trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, ',')[1]),\r",
                "                    SHIP_TO_LOCATION_CITY\r",
                "                  )\r",
                "          )          \r",
                "     ),\r",
                "toString(null())),",
                "          SHIP_TO_STATION_STATE = iif(\r",
                "TRANSPORTATION_MODE_CODE == \"RAIL\",\r",
                "     case(\r",
                "          SHIP_TO_TYPE == \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, ',')[2]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, \",\")) >= 3\r",
                "               && in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE1, ',')[2]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, ',')[2]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\")) >= 3 \r",
                "               || size(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\")) < 2,\r",
                "               iif(\r",
                "                         in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "                         trim(split(SnkPlantMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).STATION_CITY_STATE2, ',')[2]),\r",
                "                         SHIP_TO_LOCATION_STATE\r",
                "                    )\r",
                "          ),\r",
                "          SHIP_TO_TYPE != \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, ',')[2]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, \",\")) >= 3\r",
                "               && in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNS, ',')[2]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, ',')[2]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\")) >= 3\r",
                "               || size(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\")) < 2,\r",
                "               iif(\r",
                "                    in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, \",\"),trim(#item)), trim(split(RAIL_ROUTE_FULL_DESC, \"-\")[size(split(RAIL_ROUTE_FULL_DESC, \"-\"))])),\r",
                "                    trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_TO_LOCATION_ID).SAP_BAHNE, ',')[2]),\r",
                "                    SHIP_TO_LOCATION_STATE\r",
                "                  )\r",
                "          )          \r",
                "     ),\r",
                "toString(null())),",
                "          SHIP_FROM_STATION_CITY = iif(\r",
                "TRANSPORTATION_MODE_CODE == \"RAIL\",\r",
                "     case(\r",
                "          SHIP_FROM_TYPE == \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, ',')[1]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, \",\")) >= 3\r",
                "               && in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, \",\"),trim(#item)), CARRIER_CODE),\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, ',')[1]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, ',')[1]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\")) >= 3 \r",
                "               || size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\")) < 2,\r",
                "               iif(\r",
                "                         in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\"),trim(#item)), CARRIER_CODE),\r",
                "                         trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, ',')[1]),\r",
                "                         SHIP_FROM_LOCATION_CITY\r",
                "                    )\r",
                "          ),\r",
                "          SHIP_FROM_TYPE != \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, ',')[1]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, \",\")) >= 3\r",
                "               && in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, \",\"),trim(#item)), CARRIER_CODE),\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, ',')[1]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, ',')[1]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\")) >= 3\r",
                "               || size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\")) < 2,\r",
                "               iif(\r",
                "                    in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\"),trim(#item)), CARRIER_CODE),\r",
                "                    trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, ',')[1]),\r",
                "                    SHIP_FROM_LOCATION_CITY\r",
                "                  )\r",
                "          )          \r",
                "     ),\r",
                "toString(null())),",
                "          SHIP_FROM_STATION_STATE = iif(\r",
                "TRANSPORTATION_MODE_CODE == \"RAIL\",\r",
                "     case(\r",
                "          SHIP_FROM_TYPE == \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, ',')[2]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, \",\")) >= 3\r",
                "               && in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, \",\"),trim(#item)), CARRIER_CODE),\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE1, ',')[2]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\")) == 2,\r",
                "               trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, ',')[2]),\r",
                "               size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\")) >= 3 \r",
                "               || size(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\")) < 2,\r",
                "               iif(\r",
                "                         in(map(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, \",\"),trim(#item)), CARRIER_CODE),\r",
                "                         trim(split(SnkPlantMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).STATION_CITY_STATE2, ',')[2]),\r",
                "                         SHIP_FROM_LOCATION_STATE\r",
                "                    )\r",
                "          ),\r",
                "          SHIP_FROM_TYPE != \"PLANT\",\r",
                "          case(\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, ',')[2]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, \",\")) >= 3\r",
                "               && in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, \",\"),trim(#item)), CARRIER_CODE),\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNS, ',')[2]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\")) == 2,\r",
                "               trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, ',')[2]),\r",
                "               size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\")) >= 3\r",
                "               || size(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\")) < 2,\r",
                "               iif(\r",
                "                    in(map(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, \",\"),trim(#item)), CARRIER_CODE),\r",
                "                    trim(split(SnkCustomerMasterXrefCache#lookup(SHIP_FROM_LOCATION_ID).SAP_BAHNE, ',')[2]),\r",
                "                    SHIP_FROM_LOCATION_STATE\r",
                "                  )\r",
                "          )          \r",
                "     ),\r",
                "toString(null())),",
                "          RAIL_ROUTE_CODE = iif(upper(trim(TRANSPORTATION_MODE_CODE))=='TRUCK' ,SCAC_CODE,RAIL_ROUTE_CODE),",
                "          CUSTOMER_PART = /* ltrim(replace(replace(replace(CUSTOMER_PART, 'PT# ', ''), 'PT#', ''), 'ADIENT', '')) */\r",
                "ltrim(replace(replace(CUSTOMER_PART, 'PT# ', ''), 'PT#', '')),",
                "          INTERNAL_SHIPMENT = iif(trim(MS_INTERPLANT)=='5','1','0')) ~> ShipFromToStationCityState",
                "ItemFreightWeightCalc window(over(FORMATTED_SOURCE_LOAD_NUMBER,",
                "          SHIPMENT_DATE,",
                "          CHARGE_TYPE),",
                "     MINIMUM_WEIGHT = toString(round(sum(toDecimal(MINIMUM_WEIGHT)),0))) ~> MinWeightCalc",
                "unpivotChargeType derive(ITEM_LH_AMOUNT = /*toString(round((toDecimal(MATL_ID_WEIGHT)*toDecimal(CUST_FRT))/toDecimal(TOTAL_SHIP_WEIGHT),2))*/\r",
                "toString(round(toDecimal(ITEM_FRT_COST),2))) ~> ItemLHAmountCalc",
                "ItemLHAmountCalc derive(ITEM_FREIGHT_WEIGHT = /* iif(trim(replace(FRT_UOM,' ','')) == 'NT'||trim(replace(FRT_UOM,' ','')) == 'NET', toString(round(toDecimal((toDecimal(ITEM_LH_AMOUNT) * 2000) / toDecimal(FRT_RATE),10,3),0)),\r",
                "iif(trim(replace(FRT_UOM,' ','')) == 'CAR', toString(round(toDecimal((toDecimal(ITEM_LH_AMOUNT) / toDecimal(FRT_RATE)),10,3),0)),\r",
                "iif(trim(replace(FRT_UOM,' ','')) == 'CWT', toString(round(toDecimal((toDecimal(ITEM_LH_AMOUNT) * 100) / toDecimal(FRT_RATE),10,3),0)),\r",
                "iif(trim(replace(FRT_UOM,' ','')) == 'TRK', toString(round(toDecimal((toDecimal(ITEM_LH_AMOUNT) / toDecimal(FRT_RATE)),10,3),0)),toString(null())))))\r",
                "*/\r",
                "iif(toString(round(toDecimal(MINIMUM_WEIGHT),0)) == '0',MATL_ID_WEIGHT,toString(round(toDecimal(MINIMUM_WEIGHT),0))),",
                "          BOL_FREIGHT_WEIGHT = toString(null())) ~> ItemFreightWeightCalc",
                "DerivedCols derive(RAIL_ROUTE_FULL_DESC = iif(\r",
                "    upper(trim(DerivedCols@SCAC_CODE)) == \"TRMX\" || upper(trim(CARRIER_CODE)) == \"TRMX\",\r",
                "    \"TERMINAL TRUCK\",\r",
                "    iif(\r",
                "        trim(TRANSPORTATION_MODE_CODE) == \"RAIL\",\r",
                "        SnkOdsRefMasterXrefCache#lookup(\"BETH\", \"ROUTE-DESCR\", \"ODS\", \"RAIL_ROUTE_FULL_DESC\", upper(trim(ROUTE_DESCR))).DESTINATION_CODE_VALUE,\r",
                "        iif(\r",
                "            trim(TRANSPORTATION_MODE_CODE) == \"TRUCK\",\r",
                "            SnkTruckRouteDesc#lookup(CastToString@SCAC_Code).carrier_name,\r",
                "            toString(null())\r",
                "        )\r",
                "    )\r",
                ")) ~> RailRouteFullDesc",
                "SelectReqClmns derive(ORIG_CUST_CODE = iif(regexMatch(trim(ORIG_CUST_CODE), `^[\\x20-\\x7E\\s]+$`), ORIG_CUST_CODE, toString(null())),",
                "          DEST_CUST_CODE = iif(regexMatch(trim(DEST_CUST_CODE), `^[\\x20-\\x7E\\s]+$`), DEST_CUST_CODE, toString(null())),",
                "          METH_OF_SHIP = iif(regexMatch(trim(METH_OF_SHIP), `^[\\x20-\\x7E\\s]+$`), METH_OF_SHIP, toString(null())),",
                "          P_C_IND = iif(regexMatch(trim(P_C_IND), `^[\\x20-\\x7E\\s]+$`), P_C_IND, toString(null())),",
                "          ROUTE_DESCR = iif(regexMatch(trim(ROUTE_DESCR), `^[\\x20-\\x7E\\s]+$`), ROUTE_DESCR, toString(null())),",
                "          SCAC_Code = iif(regexMatch(trim(SCAC_Code), `^[\\x20-\\x7E\\s]+$`), SCAC_Code, toString(null())),",
                "          ACCT_PROD_CODE = iif(regexMatch(trim(ACCT_PROD_CODE), `^[\\x20-\\x7E\\s]+$`), ACCT_PROD_CODE, toString(null()))) ~> derivedColumn12",
                "ValidShipmentRecord1 split(isNull(BETH_SOURCE_CODE) || trim(BETH_SOURCE_CODE)==\"\",",
                "     disjoint: false) ~> FreightSplit@(FreightError, FreightValid)",
                "FreightErrorFields derive(ERROR_FLAG = 'FR',",
                "          ERROR_FIELDS = rtrim(\r",
                "iif(!isNull(LOAD_NUMBER_ERROR), \"LOAD_NUMBER,\", \"\")\r",
                ", \",\"),",
                "          ERROR_MESSAGE = rtrim(\r",
                "iif(!isNull(BETH_SOURCE_CODE_ERROR), concat(BETH_SOURCE_CODE_ERROR, \",\"), \"\")\r",
                ",\",\")) ~> FreightErrorFieldsAggregation",
                "FreightSplit@FreightValid split(/* isNull(OUT_HEAT_NBR) || trim(OUT_HEAT_NBR) == \"\" || */\r",
                "iif(!startsWith(upper(trim(MS_ORDER_MILL_SPLIT_NO2)), \"E\") ,\r",
                "iif(isNull(OUT_HEAT_NBR)||trim(OUT_HEAT_NBR)==\"\",true(),false()),false()) ||\r",
                "isNull(ITEM_SHIPPED_PIECES) || trim(ITEM_SHIPPED_PIECES) == \"\" || trim(ITEM_SHIPPED_PIECES)=='0' ||\r",
                "iif(SHIP_TO_TYPE=='CUSTOMER',isNull(ACCT_PROD_CODE) || isNull(SUB_COMMODITY), false())||\r",
                "\r",
                "iif(PAYMENT_TYPE=='P' && TRIP_TITLE=='0',\r",
                "isNull(MINIMUM_WEIGHT) || trim(MINIMUM_WEIGHT)==\"\" ||\r",
                "iif(trim(DISTANCE_UOM)=='MILES', isNull(MILEAGE) ||  trim(MILEAGE)==\"\", false()) ||\r",
                "\r",
                "iif(FRT_SC_RATE_FLAG == \"Y\", isNull(FRT_SC_RATE)||trim(FRT_SC_RATE)==\"\", \r",
                "iif(FRT_RATE_FLAG == \"Y\", isNull(FRT_RATE)||trim(FRT_RATE)==\"\", \r",
                "iif(ADDTNL_FRT_RATE_FLAG == \"Y\", isNull(ADDTNL_FRT_RATE)||trim(ADDTNL_FRT_RATE)==\"\", false()))) ||\r",
                "\r",
                "iif(FRT_SC_UOM_FLAG == \"Y\", isNull(FRT_SC_UOM)||trim(FRT_SC_UOM)==\"\", \r",
                "iif(FRT_UOM_FLAG == \"Y\", isNull(FRT_UOM)||trim(FRT_UOM)==\"\", \r",
                "iif(ADDTNL_FRT_UOM_FLAG == \"Y\", isNull(ADDTNL_FRT_UOM)||trim(ADDTNL_FRT_UOM)==\"\", false()))) ||\r",
                "\r",
                "iif(MATL_ID_SC_AMT_FLAG == \"Y\", isNull(MATL_ID_SC_AMT)||trim(MATL_ID_SC_AMT)==\"\", \r",
                "iif(ITEM_FRT_COST_FLAG == \"Y\", isNull(ITEM_FRT_COST)||trim(ITEM_FRT_COST)==\"\", \r",
                "iif(MATL_ID_PRO_AMT_FLAG == \"Y\", isNull(MATL_ID_PRO_AMT)||trim(MATL_ID_PRO_AMT)==\"\", false())))\r",
                "\r",
                ", false()),",
                "     disjoint: false) ~> InvoiceSplit@(InvoiceError, InvoiceValid)",
                "InvoiceErrorFields derive(ERROR_FLAG = 'IN',",
                "          ERROR_FIELDS = rtrim(\r",
                "/* iif(!isNull(OUT_HEAT_NBR_ERROR), \"OUT_HEAT_NBR,\", \"\") + */\r",
                "iif(!startsWith(upper(trim(MS_ORDER_MILL_SPLIT_NO2)), \"E\"),\r",
                "iif(!isNull(OUT_HEAT_NBR_ERROR),\"OUT_HEAT_NBR,\",\"\"),\"\") + \r",
                "\r",
                "iif(!isNull(ITEM_SHIPPED_PIECES_ERROR), \"ITEM_SHIPPED_PIECES,\", \"\") +\r",
                "iif(SHIP_TO_TYPE=='CUSTOMER',iif(!isNull(ACCT_PROD_CODE_ERROR), \"ACCT_PRODUCT_CODE,\", \"\")+iif(!isNull(SUB_COMMODITY_ERROR), \"ACCT_PRODUCT_CODE,\", \"\"),\"\")+\r",
                "\r",
                "iif(PAYMENT_TYPE == \"P\" && TRIP_TITLE=='0',\r",
                "iif(trim(DISTANCE_UOM)==\"MILES\", iif(!isNull(MILEAGE_ERROR), \"MILEAGE,\", \"\"), \"\") +\r",
                "iif(!isNull(MINIMUM_WEIGHT_ERROR), \"MINIMUM_WEIGHT,\", \"\") +\r",
                "\r",
                "iif(FRT_SC_RATE_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_SC_RATE_ERROR),\"FRT_SC_RATE,\",\"\"),\"\") + \r",
                "iif(FRT_RATE_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_RATE_ERROR),\"FRT_RATE,\",\"\"),\"\") + \r",
                "iif(ADDTNL_FRT_RATE_FLAG == \"Y\", \r",
                "iif(!isNull(ADDTNL_FRT_RATE_ERROR),\"ADDTNL_FRT_RATE,\",\"\"),\"\") +\r",
                "\r",
                "iif(FRT_SC_UOM_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_SC_UOM_ERROR),\"FRT_SC_UOM,\",\"\"),\"\") + \r",
                "iif(FRT_UOM_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_UOM_ERROR),\"FRT_UOM,\",\"\"),\"\") + \r",
                "iif(ADDTNL_FRT_UOM_FLAG == \"Y\", \r",
                "iif(!isNull(ADDTNL_FRT_UOM_ERROR),\"ADDTNL_FRT_UOM,\",\"\"),\"\") +\r",
                "\r",
                "iif(MATL_ID_SC_AMT_FLAG == \"Y\", \r",
                "iif(!isNull(MATL_ID_SC_AMT_ERROR),\"MATL_ID_SC_AMT,\",\"\"),\"\") + \r",
                "iif(ITEM_FRT_COST_FLAG == \"Y\", \r",
                "iif(!isNull(ITEM_FRT_COST_ERROR),\"ITEM_FRT_COST,\",\"\"),\"\") + \r",
                "iif(MATL_ID_PRO_AMT_FLAG == \"Y\", \r",
                "iif(!isNull(MATL_ID_PRO_AMT_ERROR),\"MATL_ID_PRO_AMT,\",\"\"),\"\")\r",
                ",  \"\") \r",
                "\r",
                ",\",\"),",
                "          ERROR_MESSAGE = rtrim(\r",
                "/* iif(!isNull(OUT_HEAT_NBR_ERROR), concat(OUT_HEAT_NBR_ERROR, \",\"), \"\") + */\r",
                "iif(!startsWith(upper(trim(MS_ORDER_MILL_SPLIT_NO2)), \"E\"),\r",
                "iif(!isNull(OUT_HEAT_NBR_ERROR),concat(OUT_HEAT_NBR_ERROR, \",\"),\"\"),\"\") +\r",
                "\r",
                "iif(!isNull(ITEM_SHIPPED_PIECES_ERROR), concat(ITEM_SHIPPED_PIECES_ERROR, \",\"), \"\") \r",
                "+iif(SHIP_TO_TYPE=='CUSTOMER',iif(!isNull(SUB_COMMODITY_ERROR), concat(SUB_COMMODITY_ERROR, \",\"), \"\")   \r",
                "+ iif(!isNull(ACCT_PROD_CODE_ERROR), concat(ACCT_PROD_CODE_ERROR, \",\"), \"\") ,\"\")+\r",
                "\r",
                "iif(PAYMENT_TYPE == \"P\" && TRIP_TITLE=='0',\r",
                "iif(trim(DISTANCE_UOM) =='MILES',iif(!isNull(MILEAGE_ERROR), concat(MILEAGE_ERROR, \",\"), \"\"), \"\") +\r",
                "iif(!isNull(MINIMUM_WEIGHT_ERROR), concat(MINIMUM_WEIGHT_ERROR, \",\"), \"\") +\r",
                "\r",
                "iif(FRT_SC_RATE_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_SC_RATE_ERROR),concat(FRT_SC_RATE_ERROR, \",\"),\"\"),\"\")+\r",
                "iif(FRT_RATE_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_RATE_ERROR),concat(FRT_RATE_ERROR, \",\"),\"\"),\"\")+\r",
                "iif(ADDTNL_FRT_RATE_FLAG == \"Y\", \r",
                "iif(!isNull(ADDTNL_FRT_RATE_ERROR),concat(ADDTNL_FRT_RATE_ERROR, \",\"),\"\"),\"\") +\r",
                "\r",
                "iif(FRT_SC_UOM_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_SC_UOM_ERROR),concat(FRT_SC_UOM_ERROR, \",\"),\"\"),\"\")+\r",
                "iif(FRT_UOM_FLAG == \"Y\", \r",
                "iif(!isNull(FRT_UOM_ERROR),concat(FRT_UOM_ERROR, \",\"),\"\"),\"\")+\r",
                "iif(ADDTNL_FRT_UOM_FLAG == \"Y\", \r",
                "iif(!isNull(ADDTNL_FRT_UOM_ERROR),concat(ADDTNL_FRT_UOM_ERROR, \",\"),\"\"),\"\")+\r",
                "\r",
                "iif(MATL_ID_SC_AMT_FLAG == \"Y\", \r",
                "iif(!isNull(MATL_ID_SC_AMT_ERROR),concat(MATL_ID_SC_AMT_ERROR, \",\"),\"\"),\"\")+\r",
                "iif(ITEM_FRT_COST_FLAG == \"Y\", \r",
                "iif(!isNull(ITEM_FRT_COST_ERROR),concat(ITEM_FRT_COST_ERROR, \",\"),\"\"),\"\")+\r",
                "iif(MATL_ID_PRO_AMT_FLAG == \"Y\", \r",
                "iif(!isNull(MATL_ID_PRO_AMT_ERROR),concat(MATL_ID_PRO_AMT_ERROR, \",\"),\"\"),\"\")\r",
                ",  \"\") \r",
                "\r",
                ",\",\")) ~> InvoiceErrorFieldsAggregation",
                "ValidErrorFields derive(ERROR_FLAG = 'N',",
                "          ERROR_FIELDS = '',",
                "          ERROR_MESSAGE = '') ~> ValidErrorFieldsAggregation",
                "InvoiceErrorFieldsAggregation select(mapColumn(",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          LOAD_NUMBER,",
                "          TRANSPORTATION_MODE_CODE,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_LOCATION_NAME1,",
                "          SHIP_FROM_LOCATION_NAME2,",
                "          SHIP_FROM_LOCATION_ADDRESS,",
                "          SHIP_FROM_LOCATION_CITY,",
                "          SHIP_FROM_LOCATION_STATE,",
                "          SHIP_FROM_LOCATION_COUNTRY,",
                "          SHIP_FROM_LOCATION_ZIPCODE,",
                "          SHIP_TO_LOCATION_ID,",
                "          SHIP_TO_LOCATION_NAME1,",
                "          SHIP_TO_LOCATION_NAME2,",
                "          SHIP_TO_LOCATION_ADDRESS,",
                "          SHIP_TO_LOCATION_CITY,",
                "          SHIP_TO_LOCATION_STATE,",
                "          SHIP_TO_LOCATION_COUNTRY,",
                "          SHIP_TO_LOCATION_ZIPCODE,",
                "          CONTROL_LOCATION_ID = SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SHIP_TO_STATION_CITY,",
                "          SHIP_TO_STATION_STATE,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          PROCESSOR_BOL,",
                "          PAYMENT_TYPE,",
                "          CARRIER_CODE,",
                "          VEHICLE_PREFIX,",
                "          VEHICLE_ID,",
                "          BOL_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          RAIL_ROUTE_CODE,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SCAC_CODE,",
                "          MATERIAL_ID = MATERAIL_ID,",
                "          ENG_GAUGE = DIM_GAUGE_ENG,",
                "          MET_GAUGE = {DIM_GAUGE_MET },",
                "          ENG_WIDTH = DIM_WIDTH_ENG,",
                "          MET_WIDTH = DIM_WIDTH_MET,",
                "          ENG_LENGTH = DIM_LENGTH_ENG,",
                "          MET_LENGTH = DIM_LENGTH_MET,",
                "          ITEM_WEIGHT,",
                "          ITEM_WEIGHT_UOM,",
                "          OVER_DIMENSIONAL,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          COMMODITY,",
                "          SUB_COMMODITY,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          HEAT_NUMBER,",
                "          CUSTOMER_PART_NO = CUSTOMER_PART,",
                "          SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          ERROR_FLAG,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGES_CALC = ERROR_MESSAGE,",
                "          CREATED_DATE,",
                "          LAST_UPDATED_DATE,",
                "          FINISH_CODE,",
                "          FREIGHT_SOURCE_SYSTEM = {Freight Source Type},",
                "          CHARGE_TYPE,",
                "          PTMX_LOAD_NUMBER,",
                "          LOAD_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          MINIMUM_RATE,",
                "          DISTANCE_MILAGE,",
                "          RATE_AUTHORITY,",
                "          CHARGE_TYPE_DESC,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          CHARGE_RATE,",
                "          CHARGE_RATE_UOM,",
                "          CURRENCY,",
                "          CHARGE_AMOUNT,",
                "          PRODUCT_CODE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          AP_SHIP_TO_TYPE,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          PROCESSOR_PIECE_ID,",
                "          SKID,",
                "          THEO_WEIGHT_LB,",
                "          THEO_WEIGHT_KG,",
                "          SHIPMENT_HEADER_COMMENTS,",
                "          MISC_COMMENTS_ITEM,",
                "          LINEAL_FEET_MT,",
                "          LINEAL_FEET_ENG,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          IS_PRIME_LFR,",
                "          SOURCE_BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          CARRIER_NAME,",
                "          TRIP_TITLE,",
                "          {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          ITEM_FREIGHT_WEIGHT,",
                "          BOL_FREIGHT_WEIGHT,",
                "          INTERNAL_SHIPMENT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> InvoiceErrorSelect",
                "ValidErrorFieldsAggregation select(mapColumn(",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          LOAD_NUMBER,",
                "          TRANSPORTATION_MODE_CODE,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_LOCATION_NAME1,",
                "          SHIP_FROM_LOCATION_NAME2,",
                "          SHIP_FROM_LOCATION_ADDRESS,",
                "          SHIP_FROM_LOCATION_CITY,",
                "          SHIP_FROM_LOCATION_STATE,",
                "          SHIP_FROM_LOCATION_COUNTRY,",
                "          SHIP_FROM_LOCATION_ZIPCODE,",
                "          SHIP_TO_LOCATION_ID,",
                "          SHIP_TO_LOCATION_NAME1,",
                "          SHIP_TO_LOCATION_NAME2,",
                "          SHIP_TO_LOCATION_ADDRESS,",
                "          SHIP_TO_LOCATION_CITY,",
                "          SHIP_TO_LOCATION_STATE,",
                "          SHIP_TO_LOCATION_COUNTRY,",
                "          SHIP_TO_LOCATION_ZIPCODE,",
                "          CONTROL_LOCATION_ID = SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SHIP_TO_STATION_CITY,",
                "          SHIP_TO_STATION_STATE,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          PROCESSOR_BOL,",
                "          PAYMENT_TYPE,",
                "          CARRIER_CODE,",
                "          VEHICLE_PREFIX,",
                "          VEHICLE_ID,",
                "          BOL_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          RAIL_ROUTE_CODE,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SCAC_CODE,",
                "          MATERIAL_ID = MATERAIL_ID,",
                "          ENG_GAUGE = DIM_GAUGE_ENG,",
                "          MET_GAUGE = {DIM_GAUGE_MET },",
                "          ENG_WIDTH = DIM_WIDTH_ENG,",
                "          MET_WIDTH = DIM_WIDTH_MET,",
                "          ENG_LENGTH = DIM_LENGTH_ENG,",
                "          MET_LENGTH = DIM_LENGTH_MET,",
                "          ITEM_WEIGHT,",
                "          ITEM_WEIGHT_UOM,",
                "          OVER_DIMENSIONAL,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          COMMODITY,",
                "          SUB_COMMODITY,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          HEAT_NUMBER,",
                "          CUSTOMER_PART_NO = CUSTOMER_PART,",
                "          SHIP_SOURCE_LAST_UPDATE_TS,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          ERROR_FLAG,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGES_CALC = ERROR_MESSAGE,",
                "          CREATED_DATE,",
                "          LAST_UPDATED_DATE,",
                "          FINISH_CODE,",
                "          FREIGHT_SOURCE_SYSTEM = {Freight Source Type},",
                "          CHARGE_TYPE,",
                "          PTMX_LOAD_NUMBER,",
                "          LOAD_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          MINIMUM_RATE,",
                "          DISTANCE_MILAGE,",
                "          RATE_AUTHORITY,",
                "          CHARGE_TYPE_DESC,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          CHARGE_RATE,",
                "          CHARGE_RATE_UOM,",
                "          CURRENCY,",
                "          CHARGE_AMOUNT,",
                "          PRODUCT_CODE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          AP_SHIP_TO_TYPE,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          PROCESSOR_PIECE_ID,",
                "          SKID,",
                "          THEO_WEIGHT_LB,",
                "          THEO_WEIGHT_KG,",
                "          SHIPMENT_HEADER_COMMENTS,",
                "          MISC_COMMENTS_ITEM,",
                "          LINEAL_FEET_MT,",
                "          LINEAL_FEET_ENG,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          IS_PRIME_LFR,",
                "          SOURCE_BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          CARRIER_NAME,",
                "          TRIP_TITLE,",
                "          {QUANTITY_PIECES },",
                "          FINISHING_PLANT,",
                "          ITEM_FREIGHT_WEIGHT,",
                "          BOL_FREIGHT_WEIGHT,",
                "          INTERNAL_SHIPMENT",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> ValidSelect",
                "FreightSplit@FreightError derive(each(match(name!=\"SHIP_FROM_LOCATION_ID\"&&name!=\"SHIP_TO_LOCATION_ID\"&&name!=\"SCAC_CODE\"&&name!=\"TRANSPORTATION_MODE_CODE\"&&name!=\"PAYMENT_TYPE\"&&name!=\"CUSTOMER_PART\"&&name!=\"SAP_ORDER_NUMBER\"&&name!=\"LEGACY_ORDER_NUMBER \"&&name!=\"EQUIPMENT_TYPE\"&&name!=\"SAP_KUNNR\"&&name!=\"PLANT_ID\"&&name!=\"RAIL_ROUTE_CODE\"&&name!=\"RAIL_ROUTE_FULL_DESC\"&&name!=\"SHIPMENT_TIME\"&&name!=\"FINISH_CODE\"&&name!=\"SHIP_TO_STATION_CITY\"&&name!=\"SHIP_TO_STATION_STATE\"&&name!=\"SUB_COMMODITY\"&&name!=\"VEHICLE_PREFIX\"&&name!=\"VEHICLE_ID\"&&name!=\"MATL_ID_WEIGHT_NUMERIC\"&&name!=\"SHIP_TO_TYPE\"&&name!=\"ITEM_SHIPPED_PIECES\"&&name!='BOL_FREIGHT_WEIGHT'), concat($$,\"_ERROR\") = iif(isNull($$),concat($0,\" cannot be null\"), iif(trim($$) == \"\",concat($0,\" cannot be empty\"),toString(null()))))) ~> FreightErrorFields",
                "InvoiceSplit@InvoiceError derive(each(match(name!=\"SHIP_FROM_LOCATION_ID\"&&name!=\"SHIP_TO_LOCATION_ID\"&&name!=\"SCAC_CODE\"&&name!=\"TRANSPORTATION_MODE_CODE\"&&name!=\"PAYMENT_TYPE\"&&name!=\"CUSTOMER_PART\"&&name!=\"SAP_ORDER_NUMBER\"&&name!=\"LEGACY_ORDER_NUMBER \"&&name!=\"EQUIPMENT_TYPE\"&&name!=\"SAP_KUNNR\"&&name!=\"PLANT_ID\"&&name!=\"RAIL_ROUTE_CODE\"&&name!=\"RAIL_ROUTE_FULL_DESC\"&&name!=\"SHIPMENT_TIME\"&&name!=\"FINISH_CODE\"&&name!=\"SHIP_TO_STATION_CITY\"&&name!=\"SHIP_TO_STATION_STATE\"&&name!=\"SUB_COMMODITY\"&&name!=\"VEHICLE_PREFIX\"&&name!=\"VEHICLE_ID\"&&name!=\"MATL_ID_WEIGHT_NUMERIC\"&&name!=\"SHIP_TO_TYPE\"&&name!=\"ITEM_SHIPPED_PIECES\"&&name!='BOL_FREIGHT_WEIGHT'), concat($$,\"_ERROR\") = iif(isNull($$),concat($0,\" cannot be null\"), iif(trim($$) == \"\",concat($0,\" cannot be empty\"),toString(null())))),",
                "          ITEM_SHIPPED_PIECES_ERROR = iif(isNull(ITEM_SHIPPED_PIECES) || trim(ITEM_SHIPPED_PIECES) == \"\"||trim(ITEM_SHIPPED_PIECES)=='0',\"ITEM_SHIPPED_PIECES Cannot be Null or 0\",toString(null())),",
                "          SUB_COMMODITY_ERROR = iif(SHIP_TO_TYPE==\"CUSTOMER\",iif(isNull(ACCT_PROD_CODE) || trim(ACCT_PROD_CODE) == \"\",toString(null()),iif(isNull(SUB_COMMODITY),concat(\"ACCT_PRODUCT_CODE value is invalid: ACCT_PRODUCT_CODE=\",ACCT_PROD_CODE,\" | Lookup File Name =  SAP_MATERIAL_GROUP_MASTER_XREF\"),toString(null()))),toString(null()))) ~> InvoiceErrorFields",
                "InvoiceSplit@InvoiceValid derive(each(match(name!=\"SHIP_FROM_LOCATION_ID\"&&name!=\"SHIP_TO_LOCATION_ID\"&&name!=\"SCAC_CODE\"&&name!=\"TRANSPORTATION_MODE_CODE\"&&name!=\"PAYMENT_TYPE\"&&name!=\"CUSTOMER_PART\"&&name!=\"SAP_ORDER_NUMBER\"&&name!=\"LEGACY_ORDER_NUMBER \"&&name!=\"EQUIPMENT_TYPE\"&&name!=\"SAP_KUNNR\"&&name!=\"PLANT_ID\"&&name!=\"RAIL_ROUTE_CODE\"&&name!=\"RAIL_ROUTE_FULL_DESC\"&&name!=\"SHIPMENT_TIME\"&&name!=\"FINISH_CODE\"&&name!=\"SHIP_TO_STATION_CITY\"&&name!=\"SHIP_TO_STATION_STATE\"&&name!=\"SUB_COMMODITY\"&&name!=\"VEHICLE_PREFIX\"&&name!=\"VEHICLE_ID\"&&name!=\"MATL_ID_WEIGHT_NUMERIC\"&&name!=\"SHIP_TO_TYPE\"&&name!=\"ITEM_SHIPPED_PIECES\"&&name!='BOL_FREIGHT_WEIGHT'), concat($$,\"_ERROR\") = iif(isNull($$),concat($0,\" cannot be null\"), iif(trim($$) == \"\",concat($0,\" cannot be empty\"),toString(null()))))) ~> ValidErrorFields",
                "derivedColumn8 derive(LkpSapPlantmaster = iifNull(SnkPlantMasterXrefCache#lookup(upper(trim(SHIP_FROM_LOCATION_ID))).SAP_PLANT_ID,SnkCustomerMasterXrefCache#lookup(upper(trim(SHIP_TO_LOCATION_ID))).SAP_KUNNR),",
                "          LkpSapCustomerMaster = SnkCustomerMasterXrefCache#lookup(upper(trim(SHIP_TO_LOCATION_ID))).SAP_KUNNR,",
                "          TIME_ZONE = iif(isNull(TIME_ZONE)||TIME_ZONE=='', 'CT', TIME_ZONE),",
                "          CARRIER_CODE_CALC = iif(((trim(TRANSPORTATION_MODE_CODE) == \"RAIL\" || trim(TRANSPORTATION_MODE_CODE) == \"BARGE\" ) && (trim(SCAC_CODE)== \"\" || isNull(SCAC_CODE))),\"E\",\"V\"),",
                "          RAIL_ROUTE_CODE_CALC = iif(((trim(TRANSPORTATION_MODE_CODE) == \"RAIL\") && (trim(ROUTE_CODE)== \"\" || isNull(ROUTE_CODE))),\"E\",\"V\"),",
                "          SCAC_CALC = iif(((trim(TRANSPORTATION_MODE_CODE) == \"TRUCK\") && (trim(SCAC_CODE)== \"\" || isNull(SCAC_CODE))),\"E\",\"V\"),",
                "          RAIL_ROUTE_FULL_DESC_CALC = iif(((trim(TRANSPORTATION_MODE_CODE) == \"RAIL\") && (trim(ROUTE_CODE)== \"\" || isNull(ROUTE_CODE)))||((trim(TRANSPORTATION_MODE_CODE) == \"TRUCK\") && (trim(SCAC_CODE)== \"\" || isNull(SCAC_CODE))),\"E\",\"V\"),",
                "          VECHICLE_PREFIX_CALC = iif(((trim(TRANSPORTATION_MODE_CODE) == \"RAIL\") && (trim(VEHICLE_PREFIX)== \"\" || isNull(VEHICLE_PREFIX))),\"E\",\"V\"),",
                "          VECHICLE_ID_CALC = iif(((trim(TRANSPORTATION_MODE_CODE) == \"RAIL\") && (trim(VEHICLE_ID)== \"\" || isNull(VEHICLE_ID))),\"E\",\"V\")) ~> derivedColumn19",
                "union1, FreightErrorSelect union(byName: true)~> union3",
                "union3, InvoiceErrorSelect union(byName: true)~> union4",
                "ConvertUpper sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['LOCAL_CUSTOMER_CODE','LEGACY_SYSTEM'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 0,",
                "     mapColumn(",
                "          SAP_PARVW,",
                "          LEGACY_SYSTEM,",
                "          LOCAL_CUSTOMER_CODE,",
                "          SAP_KUNNR",
                "     )) ~> SnkLegacyMasterCache",
                "OdsStandardConversion sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['SOURCE_SYSTEM_Name','SOURCE_CODE_TYPE','DESTINATION_SYSTEM_Name','DESTINATION_CODE_TYPE','SOURCE_CODE_VALUE'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 0) ~> SnkOdsRefMasterXrefCache",
                "FtrBeth sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['SAP_LEGACY_PLANT_CODE','SAP_SOURCE_SYSTEM_Name'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 0) ~> SnkLegacyPlantXref",
                "SrcLkpSapPlantMaster sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['SAP_PLANT_ID'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 0) ~> SnkPlantMasterXrefCache",
                "SrcLkpSapCustomerMaster sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['SAP_KUNNR'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 0) ~> SnkCustomerMasterXrefCache",
                "select1 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     format: 'parquet',",
                "     partitionFileNames:[($NewShipmentFileName)],",
                "     umask: 0022,",
                "     preCommands: [],",
                "     postCommands: [],",
                "     mapColumn(",
                "          SOURCE_SYSTEM,",
                "          BOL_NUMBER,",
                "          SOURCE_LOAD_NUMBER,",
                "          PROCESSOR_BOL,",
                "          SHIPMENT_DATE,",
                "          SHIPMENT_TIME,",
                "          LOAD_NUMBER,",
                "          TRANSPORTATION_MODE_CODE,",
                "          SHIP_FROM_LOCATION_ID,",
                "          SHIP_FROM_LOCATION_NAME1,",
                "          SHIP_FROM_LOCATION_NAME2,",
                "          SHIP_FROM_LOCATION_ADDRESS,",
                "          SHIP_FROM_LOCATION_CITY,",
                "          SHIP_FROM_LOCATION_STATE,",
                "          SHIP_FROM_LOCATION_COUNTRY,",
                "          SHIP_FROM_LOCATION_ZIP,",
                "          SHIP_TO_LOCATION_ID,",
                "          SHIP_TO_LOCATION_NAME1,",
                "          SHIP_TO_LOCATION_NAME2,",
                "          SHIP_TO_LOCATION_ADDRESS,",
                "          SHIP_TO_LOCATION_CITY,",
                "          SHIP_TO_LOCATION_STATE,",
                "          SHIP_TO_LOCATION_COUNTRY,",
                "          SHIP_TO_LOCATION_ZIP,",
                "          SHIP_FROM_TYPE,",
                "          SHIP_TO_TYPE,",
                "          SHIPMENT_TYPE,",
                "          PAYMENT_TYPE,",
                "          CARRIER_CODE,",
                "          VEHICLE_PREFIX,",
                "          VEHICLE_ID,",
                "          BOL_WEIGHT,",
                "          BOL_WEIGHT_UOM,",
                "          EQUIPMENT_TYPE,",
                "          RAIL_ROUTE_CODE,",
                "          RAIL_ROUTE_FULL_DESC,",
                "          SHIP_FROM_STATION_CITY,",
                "          SHIP_FROM_STATION_STATE,",
                "          SHIP_TO_STATION_CITY,",
                "          SHIP_TO_STATION_STATE,",
                "          SCAC_CODE,",
                "          ITEM_NUMBER,",
                "          INTERNAL_SHIPMENT,",
                "          MATERIAL_ID,",
                "          DIM_GAUGE_ENG,",
                "          DIM_GAUGE_MET,",
                "          DIM_WIDTH_ENG,",
                "          DIM_WIDTH_MET,",
                "          DIM_LENGTH_ENG,",
                "          DIM_LENGTH_MET,",
                "          ITEM_WEIGHT,",
                "          ITEM_WEIGHT_UOM,",
                "          OVER_DIMENSIONAL,",
                "          ITEM_COUNT,",
                "          STCC_CODE,",
                "          COMMODITY,",
                "          SUB_COMMODITY,",
                "          SAP_ORDER_NUMBER,",
                "          LEGACY_ORDER_NUMBER,",
                "          HEAT_NUMBER,",
                "          CUSTOMER_PART,",
                "          FINISH_CODE,",
                "          SHIP_SOURCE_LAST_UPDATED_DATE,",
                "          SHIPMENT_STATUS,",
                "          SHIP_FROM_LEGACY_CODE,",
                "          SHIP_TO_LEGACY_CODE,",
                "          ERROR_FLAG,",
                "          ERROR_FIELDS,",
                "          ERROR_MESSAGE,",
                "          CREATED_DATE,",
                "          LAST_MODIFIED_DATE,",
                "          CHARGE_TYPE,",
                "          PTMX_LOAD_NUMBER,",
                "          LOAD_WEIGHT,",
                "          MINIMUM_WEIGHT,",
                "          MINIMUM_RATE,",
                "          DISTANCE = DISTANCE_MILAGE,",
                "          RATE_AUTHORITY,",
                "          CHARGE_TYPE_DESC,",
                "          FUEL_SURCHARGE_AGREEMENT_CODE,",
                "          CHARGE_RATE,",
                "          CHARGE_RATE_UOM,",
                "          CURRENCY,",
                "          CHARGE_AMOUNT,",
                "          PRODUCT_CODE,",
                "          BILL_TO_CUSTOMER_ID,",
                "          AP_SHIP_TO_TYPE,",
                "          CUSTOMER_SUFFIX,",
                "          PURCHASE_ORDER_NUMBER,",
                "          VENDOR_NUMBER,",
                "          CUSTOMER_PLANT_ID,",
                "          PRODUCT_DESC,",
                "          OWNING_PLANT_ID,",
                "          MILL_ORDER_NUMBER,",
                "          DIVISION_CODE,",
                "          PROCESSOR_PIECE_ID,",
                "          SKID,",
                "          THEO_WEIGHT_LB,",
                "          THEO_WEIGHT_KG,",
                "          SHIPMENT_HEADER_COMMENTS,",
                "          MISC_COMMENTS_ITEM,",
                "          LINEAL_FEET_MT,",
                "          LINEAL_FEET_ENG,",
                "          IS_PRIME_LFR,",
                "          SOURCE_BOL_NUMBER,",
                "          CARRIER_NAME,",
                "          TRIP_TITLE,",
                "          QUANTITY_PIECES,",
                "          FINISHING_PLANT,",
                "          ITEM_FREIGHT_WEIGHT,",
                "          BOL_FREIGHT_WEIGHT,",
                "          LEGACY_CUSTOMER_CODE,",
                "          TIMEZONE,",
                "          CONTROL_LOCATION_ID = SHIP_FROM_LOCATION_ID",
                "     ),",
                "     partitionBy('hash', 1)) ~> shipmentparquet",
                "OdsStandardConv sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['SOURCE_CODE_TYPE','DESTINATION_SYSTEM_Name','DESTINATION_CODE_TYPE','SOURCE_CODE_VALUE'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 1) ~> CacheSnkSapMaterialGroupXref",
                "SelectErr sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     format: 'parquet',",
                "     partitionFileNames:[($ERROR_FILENAME)],",
                "     umask: 0022,",
                "     preCommands: [],",
                "     postCommands: [],",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     partitionBy('hash', 1)) ~> SnkErr",
                "SrcSapPrimeLFR sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['MATERIAL_GROUP_CODE'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 1) ~> SnkSapPrimeLFR",
                "SrcTruckRailRouteDesc sink(validateSchema: false,",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     keys:['carrier_id'],",
                "     store: 'cache',",
                "     format: 'inline',",
                "     output: false,",
                "     saveOrder: 1) ~> SnkTruckRouteDesc"
            ]
        }
    }
}